<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>《周易》</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'SimSun', serif;
            background-color: #f5f5dc;
            color: #2c2c2c;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            height: 100vh;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
            -webkit-touch-callout: default;
        }

        .main-container {
            height: calc(100vh - 60px);
            overflow-y: auto;
        }

        .main-content {
            padding: 20px 40px;
            background-color: #f5f5dc;
            min-height: 100%;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
            -webkit-touch-callout: default;
        }

        /* 底部导航栏样式 */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: #2d2d2d;
            border-top: 1px solid #444;
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 0;
            z-index: 1000;
            width: 100%;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 12px;
            cursor: pointer;
            color: #e0e0e0;
            transition: all 0.3s ease;
            border-radius: 8px;
            min-width: 60px;
        }

        .nav-item:hover {
            background-color: #404040;
            color: #ffffff;
        }

        .nav-item.active {
            background-color: #555;
            color: #ffffff;
        }

        .nav-icon {
            font-size: 18px;
            margin-bottom: 2px;
        }

        .nav-label {
            font-size: 12px;
            text-align: center;
        }

        /* 目录面板样式 */
        .directory-panel {
            position: fixed;
            bottom: 60px;
            left: 0;
            right: 0;
            background-color: #2d2d2d;
            border-top: 1px solid #444;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 999;
            padding: 20px;
        }

        .directory-panel.show {
            transform: translateY(0);
        }

        /* 面板样式 */
        .panel {
            position: fixed;
            bottom: 60px;
            left: 0;
            right: 0;
            background-color: #2d2d2d;
            border-top: 1px solid #444;
            max-height: 400px;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 999;
        }

        .panel.show {
            transform: translateY(0);
        }

        .panel-content {
            padding: 20px;
        }

        /* 目录样式 */
        .toc {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .toc-item {
            margin-bottom: 10px;
        }

        .toc-item > a {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: #3a3a3a;
            color: #e0e0e0;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .toc-item > a:hover {
            background-color: #4a4a4a;
        }

        .toc-toggle {
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .toc-item.active .toc-toggle {
            transform: rotate(90deg);
        }

        .toc-sub {
            list-style: none;
            padding: 0;
            margin: 10px 0 0 20px;
            display: none;
        }

        .toc-item.active .toc-sub {
            display: block;
        }

        .toc-sub li {
            margin-bottom: 5px;
        }

        .toc-sub a {
            display: block;
            padding: 8px 15px;
            background-color: #2a2a2a;
            color: #ccc;
            text-decoration: none;
            border-radius: 3px;
            transition: background-color 0.3s ease;
        }

        .toc-sub a:hover {
            background-color: #3a3a3a;
        }

        /* 内容样式 */
        .content-section {
            margin-bottom: 40px;
        }

        .section-title {
            color: #2c2c2c;
            font-size: 28px;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #555;
            text-align: center;
        }

        .chapter-content {
            margin-bottom: 30px;
        }

        .chapter-title {
            color: #2c2c2c;
            font-size: 20px;
            margin-bottom: 15px;
        }

        .chapter-content p {
            margin-bottom: 15px;
            line-height: 1.8;
        }

        /* 卦象符号样式 */
        .hexagram-symbol {
            text-align: left;
            margin: 10px 0;
            font-size: 16px;
            line-height: 1.2;
            font-family: 'Courier New', monospace;
        }


        /* 笔记项样式 */
        .note-item {
            background-color: #3a3a3a;
            margin: 0;
            padding: 15px;
            border-radius: 0;
            border-bottom: 1px solid #555;
            width: 100%;
            box-sizing: border-box;
        }
        
        .note-item:last-child {
            border-bottom: none;
        }

        .note-text {
            color: #e0e0e0;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .note-content {
            color: #ccc;
            margin-bottom: 10px;
        }

        .note-actions {
            display: flex;
            gap: 10px;
        }

        .note-action-btn {
            background-color: #555;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .note-action-btn:hover {
            background-color: #666;
        }

        .note-locate-btn {
            background-color: #4CAF50;
        }

        .note-delete-btn {
            background-color: #f44336;
        }

        /* 夜间模式 */
        .night-mode {
            background-color: #1a1a1a !important;
            color: #e0e0e0 !important;
        }

        .night-mode .main-content {
            background-color: #1a1a1a !important;
            color: #e0e0e0 !important;
        }

        .night-mode .bottom-nav {
            background-color: #2d2d2d !important;
        }

        .night-mode .panel {
            background-color: #2d2d2d !important;
        }

        .night-mode .directory-panel {
            background-color: #2d2d2d !important;
        }

        .night-mode .section-title {
            color: #ffffff !important;
        }

        .night-mode .chapter-title {
            color: #ffffff !important;
        }

        /* 笔记功能样式 */
        .highlighted-text {
            background-color: #ffeb3b;
            color: #000;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        /* 笔记列表样式 */
        .note-text-highlight {
            transition: all 0.3s ease;
        }
        
        .note-text-highlight:hover {
            background-color: #ffeb3b;
            color: #000;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .highlighted-text:hover {
            background-color: #ffc107;
        }

        .note-button-container {
            position: absolute;
            background-color: #555;
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            pointer-events: auto;
        }

        .note-option-btn {
            background-color: #555;
            color: white;
            border: none;
            padding: 8px 12px;
            margin: 2px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .note-option-btn:hover {
            background-color: #666;
        }

        .note-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 10001;
            display: none;
        }

        .note-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
            z-index: 10002;
            display: none;
        }

        .note-popup h3 {
            color: #ffffff;
            margin-bottom: 15px;
        }

        .note-popup textarea {
            width: 100%;
            height: 100px;
            background-color: #3a3a3a;
            color: #e0e0e0;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 15px;
            resize: vertical;
        }

        .note-popup .button-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .note-popup button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .note-popup .save-btn {
            background-color: #666;
            color: white;
        }

        .note-popup .delete-btn {
            background-color: #666;
            color: white;
        }

        .note-popup .cancel-btn {
            background-color: #666;
            color: white;
        }

        .note-popup button:hover {
            background-color: #777;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-content {
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
    <div class="main-content">
        <div id="xici-shang" class="content-section">
            <h1 class="section-title">《系辞传·上》
                <p style="color: #999; margin: 10px 0 0 0; font-size: 16px; font-weight: normal;">讲《易》的宇宙观、哲学性质。</p>
            </h1>
            
            <div id="xici-shang-1" class="chapter-content">
                <h3 class="chapter-title">系辞传上·第一章</h3>
                <p>天尊地卑，乾坤定矣。卑高以陈，贵贱位矣。动静有常，刚柔断矣。方以类聚，物以群分，吉凶生矣。　在天成象，在地成形，变化见矣。是故刚柔相摩，八卦相荡，鼓之以雷霆，润之以风雨；日月运行，一寒一暑。乾道成男，坤道成女。乾知大始，坤作成物。乾以易知，坤以简能；易则易知，简则易从；易知则有亲，易从则有功；有亲则可久，有功则可大；可久则贤人之德，可大则贤人之业。易简而天下之理得矣。天下之理得，而成位乎其中矣。</p>
            </div>

            <div id="xici-shang-2" class="chapter-content">
                <h3 class="chapter-title">系辞传上·第二章</h3>
                <p>圣人设卦观象，系辞焉而明吉凶，刚柔相推而生变化。是故吉凶者，失得之象也；悔吝者，忧虞之象也；变化者，进退之象也；刚柔者，昼夜之象也。六爻之动，三极之道也。是故君子所居而安者，《易》之序也；所乐而玩者，爻之辞也。是故君子居则观其象而玩其辞，动则观其变而玩其占，是以自天佑之，吉无不利。</p>
            </div>

            <div id="xici-shang-3" class="chapter-content">
                <h3 class="chapter-title">系辞传上·第三章</h3>
                <p>彖者，言乎象者也；爻者，言乎变者也。吉凶者，言乎其失得也；悔吝者，言乎其小疵也。无咎者，善补过者也。是故列贵贱者存乎位，齐小大者存乎卦，辩吉凶者存乎辞，忧悔吝者存乎介，震无咎者存乎悔。是故卦有小大，辞有险易；辞也者，各指其所之。</p>
            </div>

            <div id="xici-shang-4" class="chapter-content">
                <h3 class="chapter-title">系辞传上·第四章</h3>
                    <p>《易》与天地准，故能弥纶天地之道。</p>
                    <p>仰以观于天文，俯以察于地理，是故知幽明之故；原始反终，故知死生之说；精气为物，游魂为变，是故知鬼神之情状。与天地相似，故不违；知周乎万物，而道济天下，故不过；旁行而不流，乐天知命，故不忧；安土敦乎仁，故能爱。范围天地之化而不过，曲成万物而不遗，通乎昼夜之道而知，故神无方而《易》无体。</p>
            </div>

            <div id="xici-shang-5" class="chapter-content">
                <h3 class="chapter-title">系辞传上·第五章</h3>
                <p>一阴一阳之谓道。继之者善也，成之者性也。仁者见之谓之仁，知者见之谓之知，百姓日用而不知，故君子之道鲜矣。显诸仁，藏诸用，鼓万物而不与圣人同忧，盛德大业至矣哉！富有之谓大业，日新之谓盛德。生生之谓易，成象之谓乾，效法之谓坤，极数知来之谓占，通变之谓事，阴阳不测之谓神。</p>
            </div>

            <div id="xici-shang-6" class="chapter-content">
                <h3 class="chapter-title">系辞传上·第六章</h3>
                <p>夫《易》广矣大矣，以言乎远则不御，以言乎迩则静而正，以言乎天地之间则备矣。夫乾，其静也专，其动也直，是以大生焉。夫坤，其静也翕，其动也辟，是以广生焉。广大配天地，变通配四时，阴阳之义配日月，易简之善配至德。</p>
            </div>

            <div id="xici-shang-7" class="chapter-content">
                <h3 class="chapter-title">系辞传上·第七章</h3>
                <p>子曰：《易》，其至矣乎！夫《易》，圣人所以崇德而广业也。知崇礼卑，崇效天，卑法地。天地设位，而《易》行乎其中矣。成性存存，道义之门。</p>
            </div>

            <div id="xici-shang-8" class="chapter-content">
                <h3 class="chapter-title">系辞传上·第八章</h3>
                <p>圣人有以见天下之赜，而拟诸其形容，像其物宜，是故谓之象。圣人有以见天下之动，而观其会通，以行其典礼，系辞焉以断其吉凶，是故谓之爻。言天下之至赜而不可恶也。言天下之至动而不可乱也。拟之而后言，议之而后动，拟议以成其变化。「鸣鹤在阴，其子和之。我有好爵，吾与尔靡之。」子曰：「君子居其室，出其言善，则千里之外应之，况其迩者乎？居其室，出其言不善，则千里之外违之，况其迩者乎？言出乎身，加乎民；行发乎迩，见乎远。言行，君子之枢机。枢机之发，荣辱之主也。言行，君子之所以动天地也，可不慎乎！」</p>
                    <p>《同人》：先号啕而后笑。</p>
                    <p>子曰：「君子之道，或出或处，或默或语。二人同心，其利断金。同心之言，其臭如兰。」</p>
                    <p>初六，藉用白茅，无咎。</p>
                    <p>子曰：「苟错诸地而可矣，藉之用茅，何咎之有？慎之至也。夫茅之为物薄，而用可重也。慎斯术也以往，其无所失矣。」</p>
                    <p>劳谦，君子有终，吉。</p>
                    <p>子曰：「劳而不伐，有功而不德，厚之至也。语以其功下人者也。德言盛，礼言恭；谦也者，致恭以存其位者也。」</p>
                    <p>亢龙有悔。</p>
                    <p>子曰：「贵而无位，高而无民，贤人在下位而无辅，是以动而有悔也。」</p>
                    <p>不出户庭，无咎。</p>
                    <p>子曰：「乱之所生也，则言语以为阶。君不密则失臣，臣不密则失身，几事不密则害成。是以君子慎密而不出也。」</p>
                    <p>子曰：「作《易》者，其知盗乎？《易》曰『负且乘，致寇至。』负也者，小人之事也。乘也者，君子之器也。小人而乘君子之器，盗思夺之矣。上慢下暴，盗思伐之矣。慢藏诲盗，冶容诲淫。</p>
                    <p>《易》曰：『负且乘，致寇至。』盗之招也。」</p>
            </div>

            <div id="xici-shang-9" class="chapter-content">
                <h3 class="chapter-title">系辞传上·第九章</h3>
                    <p>天一，地二；天三，地四；天五，地六；天七，地八；天九，地十。天数五，地数五，五位相得而各有合；天数二十有五，地数三十，凡天地之数五十有五，此所以成变化而行鬼神也。</p>
                    <p>大衍之数五十，其用四十有九。分而为二以像两，挂一以像三，揲之以四以象四时，归奇于扐以象闰；五岁再闰，故再扐而后挂。</p>
                    <p>《乾》之策二百一十有六，《坤》之策百四十有四，凡三百六十，当期之日。二篇之策，万有一千五百二十，当万物之数也。是故四营而成《易》，十有八变而成卦，八卦而小成。引而伸之，触类而长之，天下之能事毕矣。</p>
                    <p>显道神德行，是故可与酬酢，可与佑神矣。子曰：「知变化之道者，其知神之所为乎。」</p>
            </div>

            <div id="xici-shang-10" class="chapter-content">
                <h3 class="chapter-title">系辞传上·第十章</h3>
                    <p>《易》有圣人之道四焉：以言者尚其辞，以动者尚其变，以制器者尚其象，以卜筮者尚其占。</p>
                    <p>是以君子将有为也，将有行也，问焉而以言，其受命也如响。无有远近幽深，遂知来物。非天下之至精，其孰能与于此。参伍以变，错综其数。通其变，遂成天下之文；极其数，遂定天下之象。非天下之至变，其孰能与于此。《易》无思也，无为也，寂然不动，感而遂通天下之故。非天下之至神，其孰能与于此。</p>
                    <p>夫《易》，圣人之所以极深而研几也。唯深也，故能通天下之志；唯几也，故能成天下之务；唯神也，故不疾而速，不行而至。子曰：「《易》有圣人之道四焉」者，此之谓也。</p>
            </div>

            <div id="xici-shang-11" class="chapter-content">
                <h3 class="chapter-title">系辞传上·第十一章</h3>
                    <p>子曰：「夫《易》何为者也？夫《易》开物成务，冒天下之道，如斯而已者也。」</p>
                    <p>是故圣人以通天下之志，以定天下之业，以断天下之疑。</p>
                    <p>是故蓍之德圆而神，卦之德方以知，六爻之义易以贡。圣人以此洗心，退藏于密，吉凶与民同患。神以知来，知以藏往，其孰能与于此哉！古之聪明睿知，神武而不杀者夫。</p>
                    <p>是以明于天之道，而察于民之故，是兴神物以前民用。圣人以此斋戒，以神明其德夫。</p>
                    <p>是故阖户谓之坤，辟户谓之乾，一阖一辟谓之变，往来不穷谓之通，见乃谓之象，形乃谓之器，制而用之谓之法，利用出入，民咸用之谓之神。</p>
                    <p>是故《易》有太极，是生两仪。两仪生四象。四象生八卦。八卦定吉凶，吉凶生大业。</p>
                    <p>是故法象莫大乎天地；变通莫大乎四时；县象着明莫大乎日月；崇高莫大乎富贵；备物致用，立成器以为天下利，莫大乎圣人探赜索隐，钩深致远，以定天下之吉凶，成天下之亹亹者，莫大乎蓍龟。</p>
                    <p>是故天生神物，圣人则之；天地变化，圣人效之；天垂象，见吉凶，圣人像之；河出图，洛出书，圣人则之。</p>
                    <p>《易》有四象，所以示也。系辞焉，所以告也；定之以吉凶，所以断也。</p>
            </div>

            <div id="xici-shang-12" class="chapter-content">
                <h3 class="chapter-title">系辞传上·第十二章</h3>
                    <p>《易》曰：「自天佑之，吉无不利。」子曰：「佑者，助也。天之所助者，顺也；人之所助者，信也。履信思乎顺，又以尚贤也。是以『自天佑之，吉无不利』也。」</p>
                    <p>子曰：「书不尽言，言不尽意。」然则圣人之意，其不可见乎？子曰：「圣人立象以尽意，设卦以尽情伪，系辞焉以尽其言。变而通之以尽利，鼓之舞之以尽神。」</p>
                    <p>乾坤，其《易》之蕴邪？乾坤成列，而《易》立乎其中矣。乾坤毁，则无以见《易》。《易》不可见，则乾坤或几乎息矣。</p>
                    <p>是故形而上者谓之道，形而下者谓之器。化而裁之谓之变，推而行之谓之通，举而错之天下之民谓之事业。</p>
                    <p>是故夫象，圣人有以见天下之赜，而拟诸其形容，像其物宜，是故谓之象。圣人有以见天下之动，而观其会通，以行其典礼，系辞焉以断其吉凶，是故谓之爻。</p>
                    <p>极天下之赜者存乎卦，鼓天下之动者存乎辞；化而裁之存乎变；推而行之存乎通；神而明之存乎其人；默而成之，不言而信，存乎德行。</p>
                </div>
            </div>

            <div id="xici-xia" class="content-section">
                <h1 class="section-title">《系辞传·下》
                    <p style="color: #999; margin: 10px 0 0 0; font-size: 16px; font-weight: normal;">讲《易》的宇宙观、哲学性质。</p>
                </h1>
                
                <div id="xici-xia-1" class="chapter-content">
                    <h3 class="chapter-title">系辞传下·第一章</h3>
                    <p>八卦成列，像在其中矣；因而重之，爻在其中矣；刚柔相推，变在其中焉；系辞焉而命之，动在其中矣。吉凶悔吝者，生乎动者也；刚柔者，立本者也；变通者，趋时者也。吉凶者，贞胜者也；天地之道，贞观者也；日月之道，贞明者也；天下之动，贞夫一者也。</p>
                    <p>夫乾，确然示人易矣；夫坤，隤然示人简矣。</p>
                    <p>爻也者，效此者也。象也者，像此者也；爻象动乎内，吉凶见乎外，功业见乎变，圣人之情见乎辞。</p>
                    <p>天地之大德曰生，圣人之大宝曰位。何以守位？曰仁。何以聚人？曰财。理财正辞、禁民为非曰义。</p>
                </div>

                <div id="xici-xia-2" class="chapter-content">
                    <h3 class="chapter-title">系辞传下·第二章</h3>
                    <p>古者包牺氏之王天下也，仰则观象于天，俯则观法于地，观鸟兽之文与地之宜，近取诸身，远取诸物，于是始作八卦，以通神明之德，以类万物之情。</p>
                    <p>作结绳而为网罟，以佃以渔，盖取诸离。</p>
                    <p>包牺氏没，神农氏作，斫木为耜，揉木为耒，耒耨之利，以教天下，盖取诸《益》。日中为市，致天下之民，聚天下之货，交易而退，各得其所，盖取诸《噬嗑》。神农氏没，黄帝、尧、舜氏作，通其变，使民不倦，神而化之，使民宜之。《易》穷则变，变则通，通则久。是以「自天佑之，吉无不利」。黄帝、尧、舜垂衣裳而天下治，盖取诸乾、坤。</p>
                    <p>刳木为舟，剡木为楫，舟楫之利，以济不通，致远以利天下，盖取诸涣。</p>
                    <p>服牛乘马，引重致远，以利天下，盖取诸随。</p>
                    <p>重门击柝，以待暴客，盖取诸豫。断木为杵，掘地为臼，杵臼之利，万民以济，盖取诸小过。</p>
                    <p>弦木为弧，剡木为矢，弧矢之利，以威天下，盖取诸睽。</p>
                    <p>上古穴居而野处，后世圣人易之以宫室，上栋下宇，以待风雨，盖取诸大壮。</p>
                    <p>古之葬者，厚衣之以薪，葬之中野，不封不树，丧期无数。后世圣人易之以棺椁，盖取诸大过。</p>
                    <p>上古结绳而治，后世圣人易之以书契，百官以治，万民以察，盖取诸夬。</p>
            </div>

                <div id="xici-xia-3" class="chapter-content">
                    <h3 class="chapter-title">系辞传下·第三章</h3>
                    <p>是故《易》者，象也；象也者，象也。</p>
                    <p>彖者，材也；爻也者，效天下之动者也。</p>
                    <p>是故吉凶生而悔吝著也。</p>
        </div>

                <div id="xici-xia-4" class="chapter-content">
                    <h3 class="chapter-title">系辞传下·第四章</h3>
                    <p>阳卦多阴，阴卦多阳，其故何也？阳卦奇，阴卦耦。其德行何也？阳一君而二民，君子之道也。阴二君而一民，小人之道也。</p>
                </div>

                <div id="xici-xia-5" class="chapter-content">
                    <h3 class="chapter-title">系辞传下·第五章</h3>
                    <p>《易》曰：「憧憧往来，朋从尔思。」子曰：「天下何思何虑？天下同归而殊途，一致而百虑。天下何思何虑？日往则月来，月往则日来，日月相推而明生焉。寒往则暑来，暑往则寒来，寒暑相推而岁成焉。往者屈也，来者信也，屈信相感而利生焉。尺蠖之屈，以求信也；龙蛇之蛰，以存身也。精义入神，以致用也；利用安身，以崇德也。过此以往，未之或知也；穷神知化，德之盛也。」</p>
                    <p>《易》曰：「困于石，据于蒺藜，入于其宫，不见其妻，凶。」子曰：「非所困而困焉，名必辱。非所据而据焉，身必危。既辱且危，死期将至，妻其可得见耶！」</p>
                    <p>《易》曰：「公用射隼于高墉之上，获之，无不利。」子曰：「隼者，禽也；弓矢者，器也；射之者，人也。君子藏器于身，待时而动，何不利之有？动而不括，是以出而有获，语成器而动者也。」</p>
                    <p>子曰：「小人不耻不仁，不畏不义，不见利不劝，不威不惩。小惩而大诫，此小人之福也。《易》曰：『履校灭趾，无咎。』此之谓也。」</p>
                    <p>「善不积不足以成名，恶不积不足以灭身。小人以小善为无益而弗为也，以小恶为无伤而弗去也，故恶积而不可掩，罪大而不可解。《易》曰：『何校灭耳，凶。』」</p>
                    <p>子曰：「危者，安其位者也；亡者，保其存者也；乱者，有其治者也。是故君子安而不忘危，存而不忘亡，治而不忘乱，是以身安而国家可保也。《易》曰：『其亡其亡，系于苞桑。』」</p>
                    <p>子曰：「德薄而位尊，知小而谋大，力小而任重，鲜不及矣。《易》曰：『鼎折足，覆公餗，其形渥，凶。』言不胜其任也。」</p>
                    <p>子曰：「知几其神乎！君子上交不谄，下交不渎，其知几乎？几者，动之微，吉之先见者也。君子见几而作，不俟终日。《易》曰：『介于石，不终日，贞吉。』介如石焉，宁用终日？断可识矣。君子知微知彰，知柔知刚，万夫之望。」</p>
                    <p>子曰：「颜氏之子，其殆庶几乎？有不善未尝不知，知之未尝复行也。《易》曰：『不远复，无祗悔，元吉。』」</p>
                    <p>「天地絪缊，万物化醇。男女构精，万物化生。《易》曰：『三人行则损一人，一人行则得其友。』言致一也。」</p>
                    <p>子曰：「君子安其身而后动，易其心而后语，定其交而后求。君子修此三者，故全也。危以动，则民不与也；惧以语，则民不应也；无交而求，则民不与也；莫之与，则伤之者至矣。《易》曰：『莫益之，或击之，立心勿恒，凶。』」</p>
                </div>

                <div id="xici-xia-6" class="chapter-content">
                    <h3 class="chapter-title">系辞传下·第六章</h3>
                    <p>子曰：「乾坤，其《易》之门邪？」乾，阳物也；坤，阴物也。阴阳合德，而刚柔有体。以体天地之撰，以通神明之德。其称名也，杂而不越。于稽其类，其衰世之意邪？</p>
                    <p>夫《易》，彰往而察来，而微显阐幽，开而当名，辨物正言断辞，则备矣。其称名也小，其取类也大。其旨远，其辞文，其言曲而中，其事肆而隐。因贰以济民行，以明失得之报。</p>
                </div>

                <div id="xici-xia-7" class="chapter-content">
                    <h3 class="chapter-title">系辞传下·第七章</h3>
                    <p>《易》之兴也，其于中古乎？作《易》者，其有忧患乎？</p>
                    <p>是故《履》，德之基也，《谦》，德之柄也，《复》，德之本也，《恒》，德之固也，《损》，德之修也，《益》，德之裕也，《困》，德之辨也，《井》，德之地也，《巽》，德之制也。</p>
                    <p>《履》，和而至。《谦》，尊而光，《复》，小而辨于物，《恒》，杂而不厌，《损》，先难而后易，《益》，长裕而不设，《困》，穷而通，《井》，居其所而迁，《巽》，称而隐。</p>
                    <p>《履》以和行，《谦》以制礼，《复》以自知，《恒》以一德，《损》以远害，《益》以兴利，《困》以寡怨，《井》以辨义，《巽》以行权。</p>
                </div>

                <div id="xici-xia-8" class="chapter-content">
                    <h3 class="chapter-title">系辞传下·第八章</h3>
                    <p>《易》之为书也不可远，为道也屡迁，变动不居，周流六虚，上下无常，刚柔相易，不可为典要，唯变所适。</p>
                    <p>其出入以度外内，使知惧。又明于忧患与故。无有师保，如临父母。初率其辞而揆其方，既有典常。苟非其人，道不虚行。</p>
                </div>

                <div id="xici-xia-9" class="chapter-content">
                    <h3 class="chapter-title">系辞传下·第九章</h3>
                    <p>《易》之为书也，原始要终，以为质也。六爻相杂，唯其时物也。其初难知，其上易知，本末也。初辞拟之，卒成之终。若夫杂物撰德，辨是与非，则非其中爻不备。噫！亦要存亡吉凶，则居可知矣。知者观其彖辞，则思过半矣。</p>
                    <p>二与四同功而异位，其善不同；二多誉，四多惧，近也。柔之为道，不利远者；其要无咎。其用柔中也。三与五同功而异位，三多凶，五多功，贵贱之等也。其柔危，其刚胜邪？</p>
                </div>

                <div id="xici-xia-10" class="chapter-content">
                    <h3 class="chapter-title">系辞传下·第十章</h3>
                    <p>《易》之为书也，广大悉备。有天道焉，有人道焉，有地道焉。兼三才而两之，故六。六者非它也，三才之道也。道有变动，故曰爻；爻有等，故曰物；物相杂，故曰文；文不当，故吉凶生焉。</p>
                </div>

                <div id="xici-xia-11" class="chapter-content">
                    <h3 class="chapter-title">系辞传下·第十一章</h3>
                    <p>《易》之兴也，其当殷之末世，周之盛德邪？当文王与纣之事邪？是故其辞危。危者使平，易者使倾。其道甚大，百物不废。惧以终始，其要无咎，此之谓《易》之道也。</p>
                </div>

                <div id="xici-xia-12" class="chapter-content">
                    <h3 class="chapter-title">系辞传下·第十二章</h3>
                    <p>夫乾，天下之至健也，德行恒易以知险。夫坤，天下之至顺也，德行恒简以知阻。能说诸心，能研诸侯之虑，定天下之吉凶，成天下之亹亹者。是故变化云为，吉事有祥。象事知器，占事知来。天地设位，圣人成能。人谋鬼谋，百姓与能。八卦以象告，爻彖以情言，刚柔杂居，而吉凶可见矣。变动以利言，吉凶以情迁。是故爱恶相攻而吉凶生，远近相取而悔吝生，情伪相感而利害生。凡《易》之情，近而不相得则凶，或害之，悔且吝。将叛者其辞惭，中心疑者其辞枝，吉人之辞寡，躁人之辞多，诬善之人其辞游，失其守者其辞屈。</p>
                </div>
            </div>

            <div id="shuogua" class="content-section">
                <h1 class="section-title">《说卦传》
                    <p style="color: #999; margin: 10px 0 0 0; font-size: 16px; font-weight: normal;">解释八卦的性质和象征意义。</p>
                </h1>
                
                <div id="shuogua-1" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第一章</h3>
                    <p>昔者圣人之作《易》也，幽赞于神明而生蓍，参天两地而倚数，观变于阴阳而立卦，发挥于刚柔而生爻，和顺于道德而理于义，穷理尽性以至于命。</p>
                </div>

                <div id="shuogua-2" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第二章</h3>
                    <p>昔者圣人之作《易》也，将以顺性命之理。是以立天之道曰阴与阳，立地之道曰柔与刚，立人之道曰仁与义。兼三才而两之，故《易》六画而成卦。分阴分阳，迭用柔刚，故《易》六位而成章。</p>
                </div>

                <div id="shuogua-3" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第三章</h3>
                    <p>天地定位，山泽通气，雷风相薄，水火不相射，八卦相错。数往者顺，知来者逆，是故《易》逆数也。</p>
                </div>

                <div id="shuogua-4" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第四章</h3>
                    <p>雷以动之，风以散之，雨以润之，日以烜之，艮以止之，兑以说之，乾以君之，坤以藏之。</p>
                </div>

                <div id="shuogua-5" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第五章</h3>
                    <p>帝出乎震，齐乎巽，相见乎离，致役乎坤，说言乎兑，战乎乾，劳乎坎，成言乎艮。万物出乎震，震东方也。齐乎巽，巽东南也；齐也者，言万物之絜齐也。离也者，明也，万物皆相见，南方之卦也，圣人南面而听天下，向明而治，盖取诸此也。坤也者，地也，万物皆致养焉，故曰致役乎坤。兑，正秋也，万物之所说也，故曰说言乎兑。战乎乾，乾西北之卦也，言阴阳相薄也。坎者水也，正北方之卦也，劳卦也，万物之所归也，故曰劳乎坎。艮，东北之卦也。万物之所成终而所成始也，故曰成言乎艮。</p>
                </div>

                <div id="shuogua-6" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第六章</h3>
                    <p>神也者，妙万物而为言者也。动万物者，莫疾乎雷；桡万物者，莫疾乎风；燥万物者，莫熯乎火；说万物者，莫说乎泽；润万物者，莫润乎水；终万物始万物者，莫盛乎艮。故水火相逮，雷风不相悖，山泽通气，然后能变化，既成万物也。</p>
                </div>

                <div id="shuogua-7" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第七章</h3>
                    <p>乾，健也；坤，顺也；震，动也；巽，入也；坎，陷也；离，丽也；艮，止也；兑，说也。</p>
                </div>

                <div id="shuogua-8" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第八章</h3>
                    <p>乾为马，坤为牛，震为龙，巽为鸡，坎为豕，离为雉，艮为狗，兑为羊。</p>
                </div>

                <div id="shuogua-9" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第九章</h3>
                    <p>乾为首，坤为腹，震为足，巽为股，坎为耳，离为目，艮为手，兑为口。</p>
                </div>

                <div id="shuogua-10" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第十章</h3>
                    <p>乾，天也，故称乎父。坤，地也，故称乎母。震一索而得男，故谓之长男。巽一索而得女，故谓之长女。坎再索而得男，故谓之中男。离再索而得女，故谓之中女。艮三索而得男，故谓之少男。兑三索而得女，故谓之少女。</p>
                </div>

                <div id="shuogua-11" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第十一章</h3>
                    <p>乾为天，为圜，为君，为父，为玉，为金，为寒，为冰，为大赤，为良马，为瘠马，为驳马，为木果。</p>
                    <p>坤为地，为母，为布，为釜，为吝啬，为均，为子母牛，为大舆，为文，为众，为柄，其于地也为黑。</p>
                    <p>震为雷，为龙，为玄黄，为敷，为大涂，为长子，为决躁，为苍筤竹，为萑苇。其于马也，为善鸣，为馵足，为作足，为的颡。其于稼也，为反生。其究为健，为蕃鲜。</p>
                    <p>巽为木，为风，为长女，为绳直，为工，为白，为长，为高，为进退，为不果，为臭。其于人也，为寡发，为广颡，为多白眼，为近利市三倍。其究为躁卦。</p>
                    <p>坎为水，为沟渎，为隐伏，为矫輮，为弓轮。其于人也，为加忧，为心病，为耳痛，为血卦，为赤。其于马也，为美脊，为亟心，为下首，为薄蹄，为曳。其于舆也，为多眚，为通，为月，为盗。其于木也，为坚多心。</p>
                    <p>离为火，为日，为电，为中女，为甲胄，为戈兵。其于人也，为大腹，为乾卦，为鳖，为蟹，为蠃，为蚌，为龟。其于木也，为科上槁。</p>
                    <p>艮为山，为径路，为小石，为门阙，为果蓏，为阍寺，为指，为狗，为鼠，为黔喙之属。其于木也，为坚多节。</p>
                    <p>兑为泽，为少女，为巫，为口舌，为毁折，为附决。其于地也，为刚卤，为妾，为羊。</p>
                </div>
            </div>

            <div id="xugua" class="content-section">
                <h1 class="section-title">《序卦传》
                    <p style="color: #999; margin: 10px 0 0 0; font-size: 16px; font-weight: normal;">解释六十四卦的排列顺序。</p>
                </h1>
                
                <div id="xugua-shang" class="chapter-content">
                    <h3 class="chapter-title">序卦传·上篇</h3>
                    <p>有天地，然后万物生焉。盈天地之间者，唯万物，故受之以《屯》；屯者盈也，屯者物之始生也。物生必蒙，故受之以《蒙》；蒙者蒙也，物之稚也。物稚不可不养也，故受之以《需》；需者饮食之道也。饮食必有讼，故受之以《讼》。讼必有众起，故受之以《师》；师者众也。众必有所比，故受之以《比》；比者比也。比必有所畜，故受之以《小畜》。物畜然后有礼，故受之以《履》。履而泰，然后安，故受之以《泰》；泰者通也。物不可以终通，故受之以《否》。物不可以终否，故受之以《同人》。与人同者，物必归焉，故受之以《大有》。有大者，不可以盈，故受之以《谦》。有大而能谦，必豫，故受之以《豫》。豫必有随，故受之以《随》。以喜随人者，必有事，故受之以《蛊》；蛊者事也。有事而后可大，故受之以《临》；临者大也。物大然后可观，故受之以《观》。可观而后有所合，故受之以《噬嗑》；嗑者合也。物不可以苟合而已，故受之以《贲》；贲者饰也。致饰然后亨则尽矣，故受之以《剥》；剥者剥也。物不可以终尽，剥穷上反下，故受之以《复》。复则不妄矣，故受之以《无妄》。有无妄然后可畜，故受之以《大畜》。物畜然后可养，故受之以《颐》；颐者养也。不养则不可动，故受之以《大过》。物不可以终过，故受之以《坎》；坎者陷也。陷必有所丽，故受之以《离》；离者丽也。</p>
                </div>

                <div id="xugua-xia" class="chapter-content">
                    <h3 class="chapter-title">序卦传·下篇</h3>
                    <p>有天地，然后有万物；有万物，然后有男女；有男女，然后有夫妇；有夫妇，然后有父子；有父子，然后有君臣；有君臣，然后有上下；有上下，然后礼义有所错。夫妇之道，不可以不久也，故受之以《恒》；恒者久也。物不可以久居其所，故受之以《遁》；遁者退也。物不可以终遁，故受之以《大壮》。物不可以终壮，故受之以《晋》；晋者进也。进必有所伤，故受之以《明夷》；夷者伤也。伤于外者，必反于家，故受之以《家人》。家道穷必乖，故受之以《睽》；睽者乖也。乖必有难，故受之以《蹇》；蹇者难也。物不可以终难，故受之以《解》；解者缓也。缓必有所失，故受之以《损》。损而不已，必益，故受之以《益》。益而不已，必决，故受之以《夬》；夬者决也。决必有所遇，故受之以《姤》；姤者遇也。物相遇而后聚，故受之以《萃》；萃者聚也。聚而上者谓之升，故受之以《升》。升而不已，必困，故受之以《困》。困乎上者，必反下，故受之以《井》。井道不可不革，故受之以《革》。革物者莫若鼎，故受之以《鼎》。主器者莫若长子，故受之以《震》；震者动也。物不可以终动，止之，故受之以《艮》；艮者止也。物不可以终止，故受之以《渐》；渐者进也。进必有所归，故受之以《归妹》。得其所归者必大，故受之以《丰》；丰者大也。穷大者必失其居，故受之以《旅》。旅而无所容，故受之以《巽》；巽者入也。入而后说之，故受之以《兑》；兑者说也。说而后散之，故受之以《涣》；涣者离也。物不可以终离，故受之以《节》。节而信之，故受之以《中孚》。有其信者，必行之，故受之以《小过》。有过物者，必济，故受之以《既济》。物不可穷也，故受之以《未济》终焉。</p>
                </div>
            </div>

            <div id="zaguagua" class="content-section">
                <h1 class="section-title">《杂卦传》
                    <p style="color: #999; margin: 10px 0 0 0; font-size: 16px; font-weight: normal;">以相反相成的观点把六十四卦重新排列。</p>
                </h1>
                
                <div class="chapter-content">
                    <p>《乾》刚《坤》柔，《比》乐《师》忧；《临》《观》之义，或与或求。《屯》见而不失其居，《蒙》杂而著。《震》，起也。《艮》，止也。《损》《益》盛衰之始也。《大畜》时也。《无妄》灾也。《萃》聚而《升》不来也。《谦》轻而《豫》怠也。《噬嗑》食也，《贲》无色也。《兑》见而《巽》伏也。《随》无故也，《蛊》则饬也。《剥》烂也，《复》反也。《晋》昼也，《明夷》诛也。《井》通而《困》相遇也。《咸》速也，《恒》久也。《涣》离也，《节》止也。《解》缓也，《蹇》难也。《睽》外也，《家人》内也。《否》《泰》反其类也。《大壮》则止，《遁》则退也。《大有》众也，《同人》亲也。《革》去故也，《鼎》取新也。《小过》过也，《中孚》信也。《丰》多故也，亲寡《旅》也。《离》上而《坎》下也。《小畜》寡也，《履》不处也。《需》不进也，《讼》不亲也。《大过》颠也。《姤》遇也，柔遇刚也。《渐》女归待男行也。《颐》养正也，《既济》定也。《归妹》女之终也。《未济》男之穷也。《夬》决也，刚决柔也，君子道长，小人道忧也。</p>
                </div>
            </div>

        <div id="yijing-shang" class="content-section">
            <h1 class="section-title">《易经·上》
                <p style="color: #999; margin: 10px 0 0 0; font-size: 16px; font-weight: normal;">上经三十卦，从乾坤开始。</p>
            </h1>
            
            <div id="gua-1" class="chapter-content">
                    <h3 class="chapter-title">乾为天第一</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                </div>
                    <p><strong>乾：元，亨，利，贞。</strong></p>
                    <p>初九：潜龙，勿用。</p>
                    <p>九二：见龙在田，利见大人。</p>
                    <p>九三：君子终日乾乾，夕惕若，厉无咎。</p>
                    <p>九四：或跃在渊，无咎。</p>
                    <p>九五：飞龙在天，利见大人。</p>
                    <p>上九：亢龙有悔。</p>
                    <p>用九：见群龙无首，吉。</p>
                    <p><strong>彖曰：</strong>大哉乾元，万物资始，乃统天。云行雨施，品物流形。大明始终，六位时成，时乘六龙以御天。乾道变化，各正性命，保合大和，乃利贞。首出庶物，万国咸宁。</p>
                    <p><strong>象曰：</strong>天行健，君子以自强不息。潜龙勿用，阳在下也。见龙在田，德施普也。终日乾乾，反复道也。或跃在渊，进无咎也。飞龙在天，大人造也。亢龙有悔，盈不可久也。用九，天德不可为首也。</p>
                    <p><strong>文言曰：</strong>元者，善之长也，亨者，嘉之会也，利者，义之和也，贞者，事之干也。君子体仁，足以长人；嘉会，足以合礼；利物，足以和义；贞固，足以干事。君子行此四者，故曰：乾：元亨利贞。</p>
                </div>

                <div id="gua-2" class="chapter-content">
                    <h3 class="chapter-title">坤为地第二</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        — —<br>
                        — —<br>
                        — —<br>
                        — —<br>
                        — —<br>
                    </div>
                    <p><strong>坤：元亨，利牝马之贞。君子有攸往，先迷后得主，利西南得朋，东北丧朋，安贞吉。</strong></p>
                    <p>初六：履霜，坚冰至。</p>
                    <p>《象》曰：履霜坚冰，阴始凝也，驯致其道，至坚冰也。</p>
                    <p>六二：直、方、大，不习，无不利。</p>
                    <p>《象》曰：六二之动，直以方也。不习无不利，地道光也。</p>
                    <p>六三：含章，可贞，或从王事，无成有终。</p>
                    <p>《象》曰：含章可贞，以时发也。或从王事，知光大也。</p>
                    <p>六四：括囊，无咎无誉。</p>
                    <p>《象》曰：括囊无咎，慎不害也。</p>
                    <p>六五：黄裳，元吉。</p>
                    <p>《象》曰：黄裳元吉，文在中也。</p>
                    <p>上六：龙战于野，其血玄黄。</p>
                    <p>《象》曰：龙战于野，其道穷也。</p>
                    <p>用六，利永贞。</p>
                    <p>《象》曰：用六永贞，以大终也。</p>
                    <p><strong>彖曰：</strong>至哉坤元，万物资生，乃顺承天。坤厚载物，德合无疆。含弘光大，品物咸亨。牝马地类，行地无疆，柔顺利贞。君子攸行，先迷失道，后顺得常。西南得朋，乃与类行。东北丧朋，乃终有庆。安贞之吉，应地无疆。</p>
                    <p><strong>象曰：</strong>地势坤。君子以厚德载物。</p>
                    <p><strong>文言曰：</strong>坤至柔而动也刚，至静而德方，后得主而有常，含万物而化光。坤道其顺乎，承天而时行。积善之家必有余庆，积不善之家必有余殃。臣弑其君，子弑其父，非一朝一夕之故，其所由来者渐矣。由辩之不早辩也。《易》曰：「履霜，坚冰至。」盖言顺也。「直」其正也，「方」其义也。君子敬以直内，义以方外，敬义立而德不孤。「直方大，不习无不利。」则不疑其所行也。阴虽有美，「含」之以从王事，弗敢成也。地道也，妻道也，臣道也。地道「无成」而代「有终」也。天地变化，草木蕃，天地闭，贤人隐。《易》曰：「括囊，无咎无誉。」盖言谨也。君子「黄」中通理，正位居体，美在其中，而畅于四支，发于事业，美之至也！阴疑于阳必战，为其嫌于无阳也。故称「龙」焉犹未离其类也，故称「血」焉。夫「玄黄」者，天地之杂也，天玄而地黄。</p>
                </div>

                <div id="gua-3" class="chapter-content">
                    <h3 class="chapter-title">水雷屯第三</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        — —<br>
                        ———<br>
                        — —<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>屯：元亨，利贞。勿用有攸往，利建侯。</strong></p>
                    <p>初九：磐桓，利居贞，利建侯。</p>
                    <p>六二：屯如邅如，乘马班如。匪寇婚媾，女子贞不字，十年乃字。</p>
                    <p>六三：即鹿无虞，惟入于林中，君子几不如舍，往吝。</p>
                    <p>六四：乘马班如，求婚媾，往吉，无不利。</p>
                    <p>九五：屯其膏，小贞吉，大贞凶。</p>
                    <p>上六：乘马班如，泣血涟如。</p>
                </div>

                <div id="gua-4" class="chapter-content">
                    <h3 class="chapter-title">山水蒙第四</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        — —<br>
                        — —<br>
                        ———<br>
                        — —<br>
                        ———<br>
                    </div>
                    <p><strong>蒙：亨。匪我求童蒙，童蒙求我。初筮告，再三渎，渎则不告。利贞。</strong></p>
                    <p>初六：发蒙，利用刑人，用说桎梏，以往吝。</p>
                    <p>九二：包蒙，吉。纳妇，吉。子克家。</p>
                    <p>六三：勿用取女，见金夫，不有躬，无攸利。</p>
                    <p>六四：困蒙，吝。</p>
                    <p>六五：童蒙，吉。</p>
                    <p>上九：击蒙，不利为寇，利御寇。</p>
                </div>

                <div id="gua-5" class="chapter-content">
                    <h3 class="chapter-title">水天需第五</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>需：有孚，光亨，贞吉。利涉大川。</strong></p>
                    <p>初九：需于郊，利用恒，无咎。</p>
                    <p>九二：需于沙，小有言，终吉。</p>
                    <p>九三：需于泥，致寇至。</p>
                    <p>六四：需于血，出自穴。</p>
                    <p>九五：需于酒食，贞吉。</p>
                    <p>上六：入于穴，有不速之客三人来，敬之终吉。</p>
                </div>

                <div id="gua-6" class="chapter-content">
                    <h3 class="chapter-title">天水讼第六</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>讼：有孚，窒惕，中吉，终凶。利见大人，不利涉大川。</strong></p>
                    <p>初六：不永所事，小有言，终吉。</p>
                    <p>九二：不克讼，归而逋，其邑人三百户，无眚。</p>
                    <p>六三：食旧德，贞厉，终吉，或从王事，无成。</p>
                    <p>九四：不克讼，复即命，渝安贞，吉。</p>
                    <p>九五：讼元吉。</p>
                    <p>上九：或锡之鞶带，终朝三褫之。</p>
                </div>

                <div id="gua-7" class="chapter-content">
                    <h3 class="chapter-title">地水师第七</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        ———<br>
                        — —<br>
                        — —<br>
                        — —<br>
                        — —<br>
                    </div>
                    <p><strong>师：贞，丈人吉，无咎。</strong></p>
                    <p>初六：师出以律，否臧凶。</p>
                    <p>九二：在师中，吉无咎，王三锡命。</p>
                    <p>六三：师或舆尸，凶。</p>
                    <p>六四：师左次，无咎。</p>
                    <p>六五：田有禽，利执言，无咎。长子帅师，弟子舆尸，贞凶。</p>
                    <p>上六：大君有命，开国承家，小人勿用。</p>
                </div>

                <div id="gua-8" class="chapter-content">
                    <h3 class="chapter-title">水地比第八</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        — —<br>
                        — —<br>
                        — —<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>比：吉。原筮元永贞，无咎。不宁方来，后夫凶。</strong></p>
                    <p>初六：有孚比之，无咎。有孚盈缶，终来有它，吉。</p>
                    <p>六二：比之自内，贞吉。</p>
                    <p>六三：比之匪人。</p>
                    <p>六四：外比之，贞吉。</p>
                    <p>九五：显比，王用三驱，失前禽。邑人不诫，吉。</p>
                    <p>上六：比之无首，凶。</p>
                </div>

                <div id="gua-9" class="chapter-content">
                    <h3 class="chapter-title">风天小畜第九</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>小畜：亨。密云不雨，自我西郊。</strong></p>
                    <p>初九：复自道，何其咎，吉。</p>
                    <p>九二：牵复，吉。</p>
                    <p>九三：舆说辐，夫妻反目。</p>
                    <p>六四：有孚，血去惕出，无咎。</p>
                    <p>九五：有孚挛如，富以其邻。</p>
                    <p>上九：既雨既处，尚德载，妇贞厉。月几望，君子征凶。</p>
                </div>

                <div id="gua-10" class="chapter-content">
                    <h3 class="chapter-title">天泽履第十</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>履：履虎尾，不咥人，亨。</strong></p>
                    <p>初九：素履，往无咎。</p>
                    <p>九二：履道坦坦，幽人贞吉。</p>
                    <p>六三：眇能视，跛能履，履虎尾，咥人，凶。武人为于大君。</p>
                    <p>九四：履虎尾，愬愬终吉。</p>
                    <p>九五：夬履，贞厉。</p>
                    <p>上九：视履考祥，其旋元吉。</p>
                </div>

                <div id="gua-11" class="chapter-content">
                    <h3 class="chapter-title">地天泰第十一</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        — —<br>
                        — —<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>泰：小往大来，吉亨。</strong></p>
                    <p>初九：拔茅茹，以其汇，征吉。</p>
                    <p>九二：包荒，用冯河，不遐遗，朋亡，得尚于中行。</p>
                    <p>九三：无平不陂，无往不复，艰贞无咎。勿恤其孚，于食有福。</p>
                    <p>六四：翩翩不富，以其邻，不戒以孚。</p>
                    <p>六五：帝乙归妹，以祉元吉。</p>
                    <p>上六：城复于隍，勿用师。自邑告命，贞吝。</p>
                </div>

                <div id="gua-12" class="chapter-content">
                    <h3 class="chapter-title">天地否第十二</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        — —<br>
                        — —<br>
                        — —<br>
                    </div>
                    <p><strong>否：否之匪人，不利君子贞，大往小来。</strong></p>
                    <p>初六：拔茅茹，以其汇，贞吉亨。</p>
                    <p>六二：包承。小人吉，大人否亨。</p>
                    <p>六三：包羞。</p>
                    <p>九四：有命无咎，畴离祉。</p>
                    <p>九五：休否，大人吉。其亡其亡，系于苞桑。</p>
                    <p>上九：倾否，先否后喜。</p>
                </div>

                <div id="gua-13" class="chapter-content">
                    <h3 class="chapter-title">天火同人第十三</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>同人：同人于野，亨。利涉大川，利君子贞。</strong></p>
                    <p>初九：同人于门，无咎。</p>
                    <p>六二：同人于宗，吝。</p>
                    <p>九三：伏戎于莽，升其高陵，三岁不兴。</p>
                    <p>九四：乘其墉，弗克攻，吉。</p>
                    <p>九五：同人，先号咷而后笑。大师克相遇。</p>
                    <p>上九：同人于郊，无悔。</p>
                </div>

                <div id="gua-14" class="chapter-content">
                    <h3 class="chapter-title">火天大有第十四</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>大有：元亨。</strong></p>
                    <p>初九：无交害，匪咎，艰则无咎。</p>
                    <p>九二：大车以载，有攸往，无咎。</p>
                    <p>九三：公用亨于天子，小人弗克。</p>
                    <p>九四：匪其彭，无咎。</p>
                    <p>六五：厥孚交如，威如；吉。</p>
                    <p>上九：自天佑之，吉无不利。</p>
                </div>

                <div id="gua-15" class="chapter-content">
                    <h3 class="chapter-title">地山谦第十五</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        — —<br>
                        — —<br>
                        — —<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>谦：亨，君子有终。</strong></p>
                    <p>初六：谦谦君子，用涉大川，吉。</p>
                    <p>六二：鸣谦，贞吉。</p>
                    <p>九三：劳谦君子，有终吉。</p>
                    <p>六四：无不利，撝谦。</p>
                    <p>六五：不富，以其邻，利用侵伐，无不利。</p>
                    <p>上六：鸣谦，利用行师，征邑国。</p>
                </div>

                <div id="gua-16" class="chapter-content">
                    <h3 class="chapter-title">雷地豫第十六</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        ———<br>
                        — —<br>
                        — —<br>
                        — —<br>
                        — —<br>
                    </div>
                    <p><strong>豫：利建侯行师。</strong></p>
                    <p>初六：鸣豫，凶。</p>
                    <p>六二：介于石，不终日，贞吉。</p>
                    <p>六三：盱豫，悔。迟有悔。</p>
                    <p>九四：由豫，大有得。勿疑。朋盍簪。</p>
                    <p>六五：贞疾，恒不死。</p>
                    <p>上六：冥豫，成有渝，无咎。</p>
                </div>

                <div id="gua-17" class="chapter-content">
                    <h3 class="chapter-title">泽雷随第十七</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>随：元亨利贞，无咎。</strong></p>
                    <p>初九：官有渝，贞吉。出门交有功。</p>
                    <p>六二：系小子，失丈夫。</p>
                    <p>六三：系丈夫，失小子。随有求得，利居贞。</p>
                    <p>九四：随有获，贞凶。有孚在道，以明，何咎。</p>
                    <p>九五：孚于嘉，吉。</p>
                    <p>上六：拘系之，乃从维之。王用亨于西山。</p>
                </div>

                <div id="gua-18" class="chapter-content">
                    <h3 class="chapter-title">山风蛊第十八</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        — —<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>蛊：元亨，利涉大川。先甲三日，后甲三日。</strong></p>
                    <p>初六：干父之蛊，有子，考无咎，厉终吉。</p>
                    <p>九二：干母之蛊，不可贞。</p>
                    <p>九三：干父之蛊，小有悔，无大咎。</p>
                    <p>六四：裕父之蛊，往见吝。</p>
                    <p>六五：干父之蛊，用誉。</p>
                    <p>上九：不事王侯，高尚其事。</p>
                </div>

                <div id="gua-19" class="chapter-content">
                    <h3 class="chapter-title">地泽临第十九</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        — —<br>
                        — —<br>
                        ———<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>临：元，亨，利，贞。至于八月有凶。</strong></p>
                    <p>初九：咸临，贞吉。</p>
                    <p>九二：咸临，吉无不利。</p>
                    <p>六三：甘临，无攸利。既忧之，无咎。</p>
                    <p>六四：至临，无咎。</p>
                    <p>六五：知临，大君之宜，吉。</p>
                    <p>上六：敦临，吉无咎。</p>
                </div>

                <div id="gua-20" class="chapter-content">
                    <h3 class="chapter-title">风地观第二十</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        — —<br>
                        — —<br>
                    </div>
                    <p><strong>观：盥而不荐，有孚颙若。</strong></p>
                    <p>初六：童观，小人无咎，君子吝。</p>
                    <p>六二：窥观，利女贞。</p>
                    <p>六三：观我生，进退。</p>
                    <p>六四：观国之光，利用宾于王。</p>
                    <p>九五：观我生，君子无咎。</p>
                    <p>上九：观其生，君子无咎。</p>
                </div>

                <div id="gua-21" class="chapter-content">
                    <h3 class="chapter-title">火雷噬嗑第二十一</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>噬嗑：亨。利用狱。</strong></p>
                    <p>初九：履校灭趾，无咎。</p>
                    <p>六二：噬肤灭鼻，无咎。</p>
                    <p>六三：噬腊肉，遇毒；小吝，无咎。</p>
                    <p>九四：噬乾胏，得金矢，利艰贞，吉。</p>
                    <p>六五：噬乾肉，得黄金，贞厉，无咎。</p>
                    <p>上九：何校灭耳，凶。</p>
                </div>

                <div id="gua-22" class="chapter-content">
                    <h3 class="chapter-title">山火贲第二十二</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        — —<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>贲：亨。小利有攸往。</strong></p>
                    <p>初九：贲其趾，舍车而徒。</p>
                    <p>六二：贲其须。</p>
                    <p>九三：贲如濡如，永贞吉。</p>
                    <p>六四：贲如皤如，白马翰如，匪寇婚媾。</p>
                    <p>六五：贲于丘园，束帛戋戋，吝，终吉。</p>
                    <p>上九：白贲，无咎。</p>
                </div>

                <div id="gua-23" class="chapter-content">
                    <h3 class="chapter-title">山地剥第二十三</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>剥：不利有攸往。</strong></p>
                    <p>初六：剥床以足，蔑贞凶。</p>
                    <p>六二：剥床以辨，蔑贞凶。</p>
                    <p>六三：剥之，无咎。</p>
                    <p>六四：剥床以肤，凶。</p>
                    <p>六五：贯鱼，以宫人宠，无不利。</p>
                    <p>上九：硕果不食，君子得舆，小人剥庐。</p>
                </div>

                <div id="gua-24" class="chapter-content">
                    <h3 class="chapter-title">地雷复第二十四</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        ———<br>
                        — —<br>
                        — —<br>
                        — —<br>
                        — —<br>
                    </div>
                    <p><strong>复：亨。出入无疾，朋来无咎。反复其道，七日来复，利有攸往。</strong></p>
                    <p>初九：不远复，无祗悔，元吉。</p>
                    <p>六二：休复，吉。</p>
                    <p>六三：频复，厉无咎。</p>
                    <p>六四：中行独复。</p>
                    <p>六五：敦复，无悔。</p>
                    <p>上六：迷复，凶，有灾眚。用行师，终有大败，以其国君，凶；至于十年，不克征。</p>
                </div>

                <div id="gua-25" class="chapter-content">
                    <h3 class="chapter-title">天雷无妄第二十五</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>无妄：元，亨，利，贞。其匪正有眚，不利有攸往。</strong></p>
                    <p>初九：无妄，往吉。</p>
                    <p>六二：不耕获，不菑畬，则利有攸往。</p>
                    <p>六三：无妄之灾，或系之牛，行人之得，邑人之灾。</p>
                    <p>九四：可贞，无咎。</p>
                    <p>九五：无妄之疾，勿药有喜。</p>
                    <p>上九：无妄，行有眚，无攸利。</p>
                </div>

                <div id="gua-26" class="chapter-content">
                    <h3 class="chapter-title">山天大畜第二十六</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>大畜：利贞，不家食吉，利涉大川。</strong></p>
                    <p>初九：有厉利已。</p>
                    <p>九二：舆说辐。</p>
                    <p>九三：良马逐，利艰贞。曰闲舆卫，利有攸往。</p>
                    <p>六四：童豕之牿，元吉。</p>
                    <p>六五：豮豕之牙，吉。</p>
                    <p>上九：何天之衢，亨。</p>
                </div>

                <div id="gua-27" class="chapter-content">
                    <h3 class="chapter-title">山雷颐第二十七</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>颐：贞吉。观颐，自求口实。</strong></p>
                    <p>初九：舍尔灵龟，观我朵颐，凶。</p>
                    <p>六二：颠颐，拂经，于丘颐，征凶。</p>
                    <p>六三：拂颐，贞凶，十年勿用，无攸利。</p>
                    <p>六四：颠颐吉，虎视眈眈，其欲逐逐，无咎。</p>
                    <p>六五：拂经，居贞吉，不可涉大川。</p>
                    <p>上九：由颐，厉吉，利涉大川。</p>
                </div>

                <div id="gua-28" class="chapter-content">
                    <h3 class="chapter-title">泽风大过第二十八</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>大过：栋桡，利有攸往，亨。</strong></p>
                    <p>初六：藉用白茅，无咎。</p>
                    <p>九二：枯杨生稊，老夫得其女妻，无不利。</p>
                    <p>九三：栋桡，凶。</p>
                    <p>九四：栋隆，吉；有它吝。</p>
                    <p>九五：枯杨生华，老妇得士夫，无咎无誉。</p>
                    <p>上六：过涉灭顶，凶，无咎。</p>
                </div>

                <div id="gua-29" class="chapter-content">
                    <h3 class="chapter-title">坎为水第二十九</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        ———<br>
                        — —<br>
                        ———<br>
                        — —<br>
                        ———<br>
                    </div>
                    <p><strong>坎：有孚，维心亨，行有尚。</strong></p>
                    <p>初六：习坎，入于坎窞，凶。</p>
                    <p>九二：坎有险，求小得。</p>
                    <p>六三：来之坎坎，险且枕，入于坎窞，勿用。</p>
                    <p>六四：樽酒簋贰，用缶，纳约自牖，终无咎。</p>
                    <p>九五：坎不盈，只既平，无咎。</p>
                    <p>上六：系用徽纆，置于丛棘，三岁不得，凶。</p>
                </div>

                <div id="gua-30" class="chapter-content">
                    <h3 class="chapter-title">离为火第三十</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        — —<br>
                        ———<br>
                        — —<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>离：利贞，亨。畜牝牛，吉。</strong></p>
                    <p>初九：履错然，敬之无咎。</p>
                    <p>六二：黄离，元吉。</p>
                    <p>九三：日昃之离，不鼓缶而歌，则大耋之嗟，凶。</p>
                    <p>九四：突如其来如，焚如，死如，弃如。</p>
                    <p>六五：出涕沱若，戚嗟若，吉。</p>
                    <p>上九：王用出征，有嘉折首，获其匪丑，无咎。</p>
                </div>
            </div>

            <div id="shuogua" class="content-section">
                <h1 class="section-title">《说卦传》
                    <p style="color: #999; margin: 10px 0 0 0; font-size: 16px; font-weight: normal;">八卦与自然、人事的对应系统。</p>
                </h1>

                <div id="shuogua-1" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第一章</h3>
                    <p>昔者，圣人之作易也，幽赞神明而生蓍。参天两地而倚数，观变於阴阳，而立卦；发挥於刚柔，而生爻；和顺於道德，而理於义；穷理尽性，以至於命。</p>
                </div>

                <div id="shuogua-2" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第二章</h3>
                    <p>昔者圣人之作易也，将以顺性命之理。是以立天之道，曰阴与阳；立地之道，曰柔与刚；立人之道，曰仁与义。兼三才而两之，故易六画而成卦。分阴分阳，迭用柔刚，故易六位而成章。</p>
                </div>

                <div id="shuogua-3" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第三章</h3>
                    <p>天地定位，山泽通气，雷风相薄，水火不相射，八卦相错，数往者顺，知来者逆；是故，易逆数也。</p>
                </div>

                <div id="shuogua-4" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第四章</h3>
                    <p>雷以动之，风以散之，雨以润之，日以烜之，艮以止之，兑以说之，乾以君之，坤以藏之。</p>
                </div>

                <div id="shuogua-5" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第五章</h3>
                    <p>帝出乎震，齐乎巽，相见乎离，致役乎坤，说言乎兑，战乎乾，劳乎坎，成言乎艮。万物出乎震，震东方也。齐乎巽，巽东南也，齐也者，言万物之洁齐也。离也者，明也，万物皆相见，南方之卦也，圣人南面而听天下，向明而治，盖取诸此也。坤也者地也，万物皆致养焉，故曰致役乎坤。兑正秋也，万物之所说也，故曰说；言乎兑。战乎乾，乾西北之卦也，言阴阳相薄也。坎者水也，正北方之卦也，劳卦也，万物之所归也，故曰劳乎坎。艮东北之卦也，万物之所成，终而所成始也，故曰成言乎艮。</p>
                </div>

                <div id="shuogua-6" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第六章</h3>
                    <p>神也者，妙万物而为言者也。动万物者，莫疾乎雷；桡万物者，莫疾乎风；燥万物者，莫熯乎火；说万物者，莫说乎泽；润万物者，莫润乎水；终万物始万物者，莫盛乎艮。故水火相逮，雷风不相悖，山泽通气，然后能变化，既成万物也。</p>
                </div>

                <div id="shuogua-7" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第七章</h3>
                    <p>乾，健也；坤，顺也；震，动也；巽，入也；坎，陷也；离，丽也；艮，止也；兑，说也。</p>
                </div>

                <div id="shuogua-8" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第八章</h3>
                    <p>乾为马，坤为牛，震为龙，巽为鸡，坎为豕，离为雉，艮为狗，兑为羊。</p>
                </div>

                <div id="shuogua-9" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第九章</h3>
                    <p>乾为首，坤为腹，震为足，巽为股，坎为耳，离为目，艮为手，兑为口。</p>
                </div>

                <div id="shuogua-10" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第十章</h3>
                    <p>乾天也，故称父，坤地也，故称母；震一索而得男，故谓之长男；巽一索而得女，故谓之长女；坎再索而男，故谓之中男；离再索而得女，故谓之中女；艮三索而得男，故谓之少男；兑三索而得女，故谓之少女。</p>
                </div>

                <div id="shuogua-11" class="chapter-content">
                    <h3 class="chapter-title">说卦传·第十一章</h3>
                    <p>乾为天、为圜、为君、为父、为玉、为金、为寒、为冰、为大赤、为良马、为瘠马、为驳马、为木果。</p>
                    <p>坤为地、为母、为布、为釜、为吝啬、为均、为子母牛、为大舆、为文、为众、为柄、其於地也为黑。</p>
                    <p>震为雷、为龙、为玄黄、为敷、为大涂、为长子、为决躁、为苍筤竹、为萑苇。其于马也，为善鸣、为馵足，为的颡。其于稼也，为反生。其究为健，为蕃鲜。</p>
                    <p>巽为木、为风、为长女、为绳直、为工、为白、为长、为高、为进退、为不果、为臭。其於人也，为寡发、为广颡、为多白眼、为近利市三倍。其究为躁卦。</p>
                    <p>坎为水、为沟渎、为隐伏、为矫輮、为弓轮。其於人也，为加忧、为心病、为耳痛、为血卦、为赤。其於马也，为美脊、为亟心、为下首、为薄蹄、为曳。其於舆也，为丁躜。为通、为月、为盗。其於木也，为坚多心。</p>
                    <p>离为火、为日、为电、为中女、为甲胄、为戈兵。其於人也，为大腹，为乾卦。为鳖、为蟹、为蠃、为蚌、为龟。其於木也，为科上槁。</p>
                    <p>艮为山、为径路、为小石、为门阙、为果苽、为阍寺、为指、为狗、为鼠、为黔喙之属。其於木也，为坚多节。</p>
                    <p>兑为泽、为少女、为巫、为口舌、为毁折、为附决。其於地也，刚卤。为妾、为羊。</p>
                </div>
            </div>

            <div id="xugua" class="content-section">
                <h1 class="section-title">《序卦传》
                    <p style="color: #999; margin: 10px 0 0 0; font-size: 16px; font-weight: normal;">说明六十四卦排列顺序的内在逻辑。</p>
                </h1>

                <div id="xugua-shang" class="chapter-content">
                    <h3 class="chapter-title">序卦传·上篇</h3>
                    <p>有天地，然后万物生焉。盈天地之间者唯万物，故受之以《屯》。《屯》者，盈也；物之始生也。物生必蒙，故受之以《蒙》。《蒙》者，蒙也；物之稚也。物稚不可不养也，故受之以《需》。《需》者，饮食之道也。饮食必有讼，故受之以《讼》。讼必有众起，故受之以《师》。《师》者，众也。众必有所比，故受之以《比》。《比》者，比也。比必有所畜，故受之以《小畜》。物畜然后有礼，故受之以《履》。履而泰然后安，故受之以《泰》。《泰》者，通也。物不可以终通，故受之以《否》。物不可以终否，故受之以《同人》。与人同者物必归焉，故受之以《大有》。有大者不可以盈，故受之以《谦》。有大而能谦必豫，故受之以《豫》。豫必有随，故受之以《随》。以喜随人者必有事，故受之以《蛊》。《蛊》者，事也。有事而后可大，故受之以《临》。《临》者，大也。物大然后可观，故受之以《观》。可观而后有所合，故受之以《噬嗑》。嗑者，合也。物不可苟合而已，故受之以《贲》。《贲》者，饰也。致饰然后亨则尽矣，故受之以《剥》。《剥》者，剥也。物不可以终尽，剥，穷上反下，故受之以《复》。复则不妄矣，故受之以《无妄》。有无妄然后可畜，故受之以《大畜》。物畜然后可养，故受之以《颐》。《颐》者，养也。不养则不可动，故受之以《大过》。物不可以终过，故受之以《坎》。《坎》者，陷也。陷必有所丽，故受之以《离》。《离》者，丽也。</p>
                </div>

                <div id="xugua-xia" class="chapter-content">
                    <h3 class="chapter-title">序卦传·下篇</h3>
                    <p>有天地，然后有万物；有万物，然后有男女；有男女，然后有夫妇；有夫妇，然后有父子；有父子，然后有君臣；有君臣，然后有上下；有上下，然后礼义有所错。夫妇之道，不可以不久也，故受之以《恒》。《恒》者，久也。物不可以久居其所，故受之以《遁》。《遁》者，退也。物不可以终遁，故受之以《大壮》。物不可以终壮，故受之以《晋》。《晋》者，进也。晋必有所伤，故受之以《明夷》。夷者，伤也。伤于外者必反其家，故受之以《家人》。家道穷必乖，故受之以《睽》。《睽》者，乖也。乖必有难，故受之以《蹇》。《蹇》者，难也。物不可以终难，故受之以《解》。《解》者，缓也。缓必有所失，故受之以《损》。损而不已必益，故受之以《益》。益而不已必决，故受之以《夬》。《夬》者，决也。决必有所遇，故受之以《姤》。《姤》者，遇也。物相遇而后聚，故受之以《萃》。《萃》者，聚也。聚而上者谓之升，故受之以《升》。升而不已必困，故受之以《困》。困乎上者必反下，故受之以《井》。井道不可不革，故受之以《革》。革物者莫若鼎，故受之以《鼎》。主器者莫若长子，故受之以《震》。《震》者，动也。物不可以终动，止之，故受之以《艮》。《艮》者，止也。物不可以终止，故受之以《渐》。《渐》者，进也。进必有所归，故受之以《归妹》。得其所归者必大，故受之以《丰》。《丰》者，大也。穷大者必失其所居，故受之以《旅》。旅而无所容，故受之以《巽》。《巽》者，入也。入而后说之，故受之以《兑》。《兑》者，说也。说而后散之，故受之以《涣》。《涣》者，离也。物不可以终离，故受之以《节》。节而信之，故受之以《中孚》。有信者必行之，故受之以《小过》。有过物者必济，故受之以《既济》。物不可穷也，故受之以《未济》终焉。</p>
                </div>
            </div>

            <div id="zagua" class="content-section">
                <h1 class="section-title">《杂卦传》</h1>
                <p style="color: #999; margin-bottom: 20px;">把卦两两对比，点出义理。</p>

                <div class="chapter-content">
                    <p>《乾》刚《坤》柔，《比》乐《师》忧。《临》、《观》之义，或与或求。《屯》见而不失其居，《蒙》杂而著。《震》，起也。《艮》，止也。《损》、《益》盛衰之始也。《大畜》时也。 《无妄》灾也。《萃》聚而《升》不来也。《谦》轻而《豫》怠也。《噬嗑》食也，《贲》无色也。《兑》见而《巽》伏也。《随》无故也，《蛊》则饬也。《剥》烂也，《复》反也。《晋》昼也。《明夷》诛也。《井》通而《困》相遇也。《咸》速也。《恒》久也。《涣》离也。《节》止也。《解》缓也。《蹇》难也。《睽》外也。《家人》内也。《否》、《泰》反其类也。《大壮》则止，《遁》则退也。《大有》众也。《同人》亲也。《革》去故也。《鼎》取新也。《小过》过也。《中孚》信也。《丰》多故也。亲寡《旅》也。《离》上而《坎》下也。《小畜》寡也。《履》不处也。《需》不进也。《讼》不亲也。《大过》颠也。《姤》遇也，柔遇刚也，《渐》女归待男行也。《颐》养正也。《既济》定也。《归妹》女之终也。《未济》男之穷也。《夬》决也，刚决柔也，君子道长，小人道忧也。</p>
                </div>
            </div>

            <div id="yijing-xia" class="content-section">
                <h1 class="section-title">《易经·下》
                    <p style="color: #999; margin: 10px 0 0 0; font-size: 16px; font-weight: normal;">下经三十四卦，从咸恒开始。</p>
                </h1>
                
                <div id="gua-31" class="chapter-content">
                    <h3 class="chapter-title">泽山咸第三十一</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>咸：亨，利贞，取女吉。</strong></p>
                    <p>初六：咸其拇。</p>
                    <p>六二：咸其腓，凶，居吉。</p>
                    <p>九三：咸其股，执其随，往吝。</p>
                    <p>九四：贞吉悔亡，憧憧往来，朋从尔思。</p>
                    <p>九五：咸其脢，无悔。</p>
                    <p>上六：咸其辅，颊，舌。</p>
                </div>

                <div id="gua-32" class="chapter-content">
                    <h3 class="chapter-title">雷风恒第三十二</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>恒：亨，无咎，利贞，利有攸往。</strong></p>
                    <p>初六：浚恒，贞凶，无攸利。</p>
                    <p>九二：悔亡。</p>
                    <p>九三：不恒其德，或承之羞，贞吝。</p>
                    <p>九四：田无禽。</p>
                    <p>六五：恒其德，贞，妇人吉，夫子凶。</p>
                    <p>上六：振恒，凶。</p>
                </div>

                <div id="gua-33" class="chapter-content">
                    <h3 class="chapter-title">天山遁第三十三</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>遁：亨，小利贞。</strong></p>
                    <p>初六：遁尾，厉，勿用有攸往。</p>
                    <p>六二：执之用黄牛之革，莫之胜说。</p>
                    <p>九三：系遁，有疾厉，畜臣妾吉。</p>
                    <p>九四：好遁君子吉，小人否。</p>
                    <p>九五：嘉遁，贞吉。</p>
                    <p>上九：肥遁，无不利。</p>
                </div>

                <div id="gua-34" class="chapter-content">
                    <h3 class="chapter-title">雷天大壮第三十四</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>大壮：利贞。</strong></p>
                    <p>初九：壮于趾，征凶，有孚。</p>
                    <p>九二：贞吉。</p>
                    <p>九三：小人用壮，君子用罔，贞厉。羝羊触藩，羸其角。</p>
                    <p>九四：贞吉悔亡，藩决不羸，壮于大舆之輹。</p>
                    <p>六五：丧羊于易，无悔。</p>
                    <p>上六：羝羊触藩，不能退，不能遂，无攸利，艰则吉。</p>
                </div>

                <div id="gua-35" class="chapter-content">
                    <h3 class="chapter-title">火地晋第三十五</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>晋：康侯用锡马蕃庶，昼日三接。</strong></p>
                    <p>初六：晋如，摧如，贞吉。罔孚，裕无咎。</p>
                    <p>六二：晋如，愁如，贞吉。受兹介福，于其王母。</p>
                    <p>六三：众允，悔亡。</p>
                    <p>九四：晋如鼫鼠，贞厉。</p>
                    <p>六五：悔亡，失得勿恤，往吉无不利。</p>
                    <p>上九：晋其角，维用伐邑，厉吉无咎，贞吝。</p>
                </div>

                <div id="gua-36" class="chapter-content">
                    <h3 class="chapter-title">地火明夷第三十六</h3>
                    <div class="hexagram-symbol">
                        — —<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>明夷：利艰贞。</strong></p>
                    <p>初九：明夷于飞，垂其翼。君子于行，三日不食，有攸往，主人有言。</p>
                    <p>六二：明夷，夷于左股，用拯马壮，吉。</p>
                    <p>九三：明夷于南狩，得其大首，不可疾贞。</p>
                    <p>六四：入于左腹，获明夷之心，出于门庭。</p>
                    <p>六五：箕子之明夷，利贞。</p>
                    <p>上六：不明晦，初登于天，后入于地。</p>
                </div>

                <div id="gua-37" class="chapter-content">
                    <h3 class="chapter-title">风火家人第三十七</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>家人：利女贞。</strong></p>
                    <p>初九：闲有家，悔亡。</p>
                    <p>六二：无攸遂，在中馈，贞吉。</p>
                    <p>九三：家人嗃嗃，悔厉吉；妇子嘻嘻，终吝。</p>
                    <p>六四：富家，大吉。</p>
                    <p>九五：王假有家，勿恤吉。</p>
                    <p>上九：有孚威如，终吉。</p>
                </div>

                <div id="gua-38" class="chapter-content">
                    <h3 class="chapter-title">火泽睽第三十八</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>睽：小事吉。</strong></p>
                    <p>初九：悔亡，丧马勿逐，自复；见恶人无咎。</p>
                    <p>九二：遇主于巷，无咎。</p>
                    <p>六三：见舆曳，其牛掣，其人天且劓，无初有终。</p>
                    <p>九四：睽孤，遇元夫，交孚，厉无咎。</p>
                    <p>六五：悔亡，厥宗噬肤，往何咎。</p>
                    <p>上九：睽孤，见豕负涂，载鬼一车，先张之弧，后说之弧，匪寇婚媾，往遇雨则吉。</p>
                </div>

                <div id="gua-39" class="chapter-content">
                    <h3 class="chapter-title">水山蹇第三十九</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>蹇：利西南，不利东北；利见大人，贞吉。</strong></p>
                    <p>初六：往蹇，来誉。</p>
                    <p>六二：王臣蹇蹇，匪躬之故。</p>
                    <p>九三：往蹇来反。</p>
                    <p>六四：往蹇来连。</p>
                    <p>九五：大蹇朋来。</p>
                    <p>上六：往蹇来硕，吉；利见大人。</p>
                </div>

                <div id="gua-40" class="chapter-content">
                    <h3 class="chapter-title">雷水解第四十</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>解：利西南，无所往，其来复吉。有攸往，夙吉。</strong></p>
                    <p>初六：无咎。</p>
                    <p>九二：田获三狐，得黄矢，贞吉。</p>
                    <p>六三：负且乘，致寇至，贞吝。</p>
                    <p>九四：解而拇，朋至斯孚。</p>
                    <p>六五：君子维有解，吉；有孚于小人。</p>
                    <p>上六：公用射隼，于高墉之上，获之，无不利。</p>
                </div>

                <div id="gua-41" class="chapter-content">
                    <h3 class="chapter-title">山泽损第四十一</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>损：有孚，元吉，无咎，可贞，利有攸往？曷之用，二簋可用享。</strong></p>
                    <p>初九：已事遄往，无咎，酌损之。</p>
                    <p>九二：利贞，征凶，弗损益之。</p>
                    <p>六三：三人行，则损一人；一人行，则得其友。</p>
                    <p>六四：损其疾，使遄有喜，无咎。</p>
                    <p>六五：或益之，十朋之龟弗克违，元吉。</p>
                    <p>上九：弗损益之，无咎，贞吉，利有攸往，得臣无家。</p>
                </div>

                <div id="gua-42" class="chapter-content">
                    <h3 class="chapter-title">风雷益第四十二</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>益：利有攸往，利涉大川。</strong></p>
                    <p>初九：利用为大作，元吉，无咎。</p>
                    <p>六二：或益之，十朋之龟弗克违，永贞吉。王用享于帝，吉。</p>
                    <p>六三：益之用凶事，无咎。有孚中行，告公用圭。</p>
                    <p>六四：中行，告公从。利用为依迁国。</p>
                    <p>九五：有孚惠心，勿问元吉。有孚惠我德。</p>
                    <p>上九：莫益之，或击之，立心勿恒，凶。</p>
                </div>

                <div id="gua-43" class="chapter-content">
                    <h3 class="chapter-title">泽天夬第四十三</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>夬：扬于王庭，孚号，有厉，告自邑，不利即戎，利有攸往。</strong></p>
                    <p>初九：壮于前趾，往不胜为咎。</p>
                    <p>九二：惕号，莫夜有戎，勿恤。</p>
                    <p>九三：壮于頄，有凶。君子夬夬，独行遇雨，若濡有愠，无咎。</p>
                    <p>九四：臀无肤，其行次且。牵羊悔亡，闻言不信。</p>
                    <p>九五：苋陆夬夬，中行无咎。</p>
                    <p>上六：无号，终有凶。</p>
                </div>

                <div id="gua-44" class="chapter-content">
                    <h3 class="chapter-title">天风姤第四十四</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>姤：女壮，勿用取女。</strong></p>
                    <p>初六：系于金柅，贞吉，有攸往，见凶，羸豕踟躅。</p>
                    <p>九二：包有鱼，无咎，不利宾。</p>
                    <p>九三：臀无肤，其行次且，厉，无大咎。</p>
                    <p>九四：包无鱼，起凶。</p>
                    <p>九五：以杞包瓜，含章，有陨自天。</p>
                    <p>上九：姤其角，吝，无咎。</p>
                </div>

                <div id="gua-45" class="chapter-content">
                    <h3 class="chapter-title">泽地萃第四十五</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        — —<br>
                    </div>
                    <p><strong>萃：亨。王假有庙，利见大人，亨，利贞。用大牲吉，利有攸往。</strong></p>
                    <p>初六：有孚不终，乃乱乃萃，若号一握为笑，勿恤，往无咎。</p>
                    <p>六二：引吉，无咎，孚乃利用禴。</p>
                    <p>六三：萃如，嗟如，无攸利，往无咎，小吝。</p>
                    <p>九四：大吉，无咎。</p>
                    <p>九五：萃有位，无咎。匪孚，元永贞，悔亡。</p>
                    <p>上六：赍咨涕洟，无咎。</p>
                </div>

                <div id="gua-46" class="chapter-content">
                    <h3 class="chapter-title">地风升第四十六</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>升：元亨，用见大人，勿恤，南征吉。</strong></p>
                    <p>初六：允升，大吉。</p>
                    <p>九二：孚乃利用禴，无咎。</p>
                    <p>九三：升虚邑。</p>
                    <p>六四：王用亨于岐山，吉无咎。</p>
                    <p>六五：贞吉，升阶。</p>
                    <p>上六：冥升，利于不息之贞。</p>
                </div>

                <div id="gua-47" class="chapter-content">
                    <h3 class="chapter-title">泽水困第四十七</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>困：亨，贞，大人吉，无咎，有言不信。</strong></p>
                    <p>初六：臀困于株木，入于幽谷，三岁不觌。</p>
                    <p>九二：困于酒食，朱绂方来，利用亨祀，征凶，无咎。</p>
                    <p>六三：困于石，据于蒺藜，入于其宫，不见其妻，凶。</p>
                    <p>九四：来徐徐，困于金车，吝，有终。</p>
                    <p>九五：劓刖，困于赤绂，乃徐有说，利用祭祀。</p>
                    <p>上六：困于葛藟，于臲卼，曰动悔。有悔，征吉。</p>
                </div>

                <div id="gua-48" class="chapter-content">
                    <h3 class="chapter-title">水风井第四十八</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>井：改邑不改井，无丧无得，往来井井。汔至，亦未繘井，羸其瓶，凶。</strong></p>
                    <p>初六：井泥不食，旧井无禽。</p>
                    <p>九二：井谷射鲋，瓮敝漏。</p>
                    <p>九三：井渫不食，为我民恻，可用汲，王明，并受其福。</p>
                    <p>六四：井甃，无咎。</p>
                    <p>九五：井洌，寒泉食。</p>
                    <p>上六：井收勿幕，有孚元吉。</p>
                </div>

                <div id="gua-49" class="chapter-content">
                    <h3 class="chapter-title">泽火革第四十九</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>革：己日乃孚，元亨利贞，悔亡。</strong></p>
                    <p>初九：巩用黄牛之革。</p>
                    <p>六二：己日乃革之，征吉，无咎。</p>
                    <p>九三：征凶，贞厉，革言三就，有孚。</p>
                    <p>九四：悔亡，有孚改命，吉。</p>
                    <p>九五：大人虎变，未占有孚。</p>
                    <p>上六：君子豹变，小人革面，征凶，居贞吉。</p>
                </div>

                <div id="gua-50" class="chapter-content">
                    <h3 class="chapter-title">火风鼎第五十</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>鼎：元吉，亨。</strong></p>
                    <p>初六：鼎颠趾，利出否，得妾以其子，无咎。</p>
                    <p>九二：鼎有实，我仇有疾，不我能即，吉。</p>
                    <p>九三：鼎耳革，其行塞，雉膏不食，方雨亏悔，终吉。</p>
                    <p>九四：鼎折足，覆公餗，其形渥，凶。</p>
                    <p>六五：鼎黄耳金铉，利贞。</p>
                    <p>上九：鼎玉铉，大吉，无不利。</p>
                </div>

                <div id="gua-51" class="chapter-content">
                    <h3 class="chapter-title">震为雷第五十一</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>震：亨。震来虩虩，笑言哑哑。震惊百里，不丧匕鬯。</strong></p>
                    <p>初九：震来虩虩，后笑言哑哑，吉。</p>
                    <p>六二：震来厉，亿丧贝，跻于九陵，勿逐，七日得。</p>
                    <p>六三：震苏苏，震行无眚。</p>
                    <p>九四：震遂泥。</p>
                    <p>六五：震往来厉，亿无丧，有事。</p>
                    <p>上六：震索索，视矍矍，征凶。震不于其躬，于其邻，无咎。婚媾有言。</p>
                </div>

                <div id="gua-52" class="chapter-content">
                    <h3 class="chapter-title">艮为山第五十二</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>艮：艮其背，不获其身，行其庭，不见其人，无咎。</strong></p>
                    <p>初六：艮其趾，无咎，利永贞。</p>
                    <p>六二：艮其腓，不拯其随，其心不快。</p>
                    <p>九三：艮其限，列其夤，厉薰心。</p>
                    <p>六四：艮其身，无咎。</p>
                    <p>六五：艮其辅，言有序，悔亡。</p>
                    <p>上九：敦艮，吉。</p>
                </div>

                <div id="gua-53" class="chapter-content">
                    <h3 class="chapter-title">风山渐第五十三</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>渐：女归吉，利贞。</strong></p>
                    <p>初六：鸿渐于干，小子厉，有言，无咎。</p>
                    <p>六二：鸿渐于磐，饮食衎衎，吉。</p>
                    <p>九三：鸿渐于陆，夫征不复，妇孕不育，凶；利御寇。</p>
                    <p>六四：鸿渐于木，或得其桷，无咎。</p>
                    <p>九五：鸿渐于陵，妇三岁不孕，终莫之胜，吉。</p>
                    <p>上九：鸿渐于陆，其羽可用为仪，吉。</p>
                </div>

                <div id="gua-54" class="chapter-content">
                    <h3 class="chapter-title">雷泽归妹第五十四</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>归妹：征凶，无攸利。</strong></p>
                    <p>初九：归妹以娣，跛能履，征吉。</p>
                    <p>九二：眇能视，利幽人之贞。</p>
                    <p>六三：归妹以须，反归以娣。</p>
                    <p>九四：归妹愆期，迟归有时。</p>
                    <p>六五：帝乙归妹，其君之袂，不如其娣之袂良，月几望，吉。</p>
                    <p>上六：女承筐无实，士刲羊无血，无攸利。</p>
                </div>

                <div id="gua-55" class="chapter-content">
                    <h3 class="chapter-title">雷火丰第五十五</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>丰：亨，王假之，勿忧，宜日中。</strong></p>
                    <p>初九：遇其配主，虽旬无咎，往有尚。</p>
                    <p>六二：丰其蔀，日中见斗，往得疑疾，有孚发若，吉。</p>
                    <p>九三：丰其沛，日中见沫，折其右肱，无咎。</p>
                    <p>九四：丰其蔀，日中见斗，遇其夷主，吉。</p>
                    <p>六五：来章，有庆誉，吉。</p>
                    <p>上六：丰其屋，蔀其家，窥其户，阒其无人，三岁不觌，凶。</p>
                </div>

                <div id="gua-56" class="chapter-content">
                    <h3 class="chapter-title">火山旅第五十六</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>旅：小亨，旅贞吉。</strong></p>
                    <p>初六：旅琐琐，斯其所取灾。</p>
                    <p>六二：旅即次，怀其资，得童仆贞。</p>
                    <p>九三：旅焚其次，丧其童仆，贞厉。</p>
                    <p>九四：旅于处，得其资斧，我心不快。</p>
                    <p>六五：射雉一矢亡，终以誉命。</p>
                    <p>上九：鸟焚其巢，旅人先笑后号啕。丧牛于易，凶。</p>
                </div>

                <div id="gua-57" class="chapter-content">
                    <h3 class="chapter-title">巽为风第五十七</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>巽：小亨，利有攸往，利见大人。</strong></p>
                    <p>初六：进退，利武人之贞。</p>
                    <p>九二：巽在床下，用史巫纷若，吉无咎。</p>
                    <p>九三：频巽，吝。</p>
                    <p>六四：悔亡，田获三品。</p>
                    <p>九五：贞吉悔亡，无不利。无初有终，先庚三日，后庚三日，吉。</p>
                    <p>上九：巽在床下，丧其资斧，贞凶。</p>
                </div>

                <div id="gua-58" class="chapter-content">
                    <h3 class="chapter-title">兑为泽第五十八</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>兑：亨，利贞。</strong></p>
                    <p>初九：和兑，吉。</p>
                    <p>九二：孚兑，吉，悔亡。</p>
                    <p>六三：来兑，凶。</p>
                    <p>九四：商兑，未宁，介疾有喜。</p>
                    <p>九五：孚于剥，有厉。</p>
                    <p>上六：引兑。</p>
                </div>

                <div id="gua-59" class="chapter-content">
                    <h3 class="chapter-title">风水涣第五十九</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>涣：亨。王假有庙，利涉大川，利贞。</strong></p>
                    <p>初六：用拯马壮，吉。</p>
                    <p>九二：涣奔其机，悔亡。</p>
                    <p>六三：涣其躬，无悔。</p>
                    <p>六四：涣其群，元吉。涣有丘，匪夷所思。</p>
                    <p>九五：涣汗其大号，涣王居，无咎。</p>
                    <p>上九：涣其血，去逖出，无咎。</p>
                </div>

                <div id="gua-60" class="chapter-content">
                    <h3 class="chapter-title">水泽节第六十</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>节：亨。苦节不可贞。</strong></p>
                    <p>初九：不出户庭，无咎。</p>
                    <p>九二：不出门庭，凶。</p>
                    <p>六三：不节若，则嗟若，无咎。</p>
                    <p>六四：安节，亨。</p>
                    <p>九五：甘节，吉；往有尚。</p>
                    <p>上六：苦节，贞凶，悔亡。</p>
                </div>

                <div id="gua-61" class="chapter-content">
                    <h3 class="chapter-title">风泽中孚第六十一</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>中孚：豚鱼吉，利涉大川，利贞。</strong></p>
                    <p>初九：虞吉，有他不燕。</p>
                    <p>九二：鸣鹤在阴，其子和之，我有好爵，吾与尔靡之。</p>
                    <p>六三：得敌，或鼓或罢，或泣或歌。</p>
                    <p>六四：月几望，马匹亡，无咎。</p>
                    <p>九五：有孚挛如，无咎。</p>
                    <p>上九：翰音登于天，贞凶。</p>
                </div>

                <div id="gua-62" class="chapter-content">
                    <h3 class="chapter-title">雷山小过第六十二</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>小过：亨，利贞，可小事，不可大事。飞鸟遗之音，不宜上宜下，大吉。</strong></p>
                    <p>初六：飞鸟以凶。</p>
                    <p>六二：过其祖，遇其妣；不及其君，遇其臣；无咎。</p>
                    <p>九三：弗过防之，从或戕之，凶。</p>
                    <p>九四：无咎，弗过遇之。往厉必戒，勿用永贞。</p>
                    <p>六五：密云不雨，自我西郊，公弋取彼在穴。</p>
                    <p>上六：弗遇过之，飞鸟离之，凶，是谓灾眚。</p>
                </div>

                <div id="gua-63" class="chapter-content">
                    <h3 class="chapter-title">水火既济第六十三</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>既济：亨，小利贞，初吉终乱。</strong></p>
                    <p>初九：曳其轮，濡其尾，无咎。</p>
                    <p>六二：妇丧其茀，勿逐，七日得。</p>
                    <p>九三：高宗伐鬼方，三年克之，小人勿用。</p>
                    <p>六四：繻有衣袽，终日戒。</p>
                    <p>九五：东邻杀牛，不如西邻之禴祭，实受其福。</p>
                    <p>上六：濡其首，厉。</p>
                </div>

                <div id="gua-64" class="chapter-content">
                    <h3 class="chapter-title">火水未济第六十四</h3>
                    <div class="hexagram-symbol">
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                        ———<br>
                    </div>
                    <p><strong>未济：亨，小狐汔济，濡其尾，无攸利。</strong></p>
                    <p>初六：濡其尾，吝。</p>
                    <p>九二：曳其轮，贞吉。</p>
                    <p>六三：未济，征凶，利涉大川。</p>
                    <p>九四：贞吉，悔亡，震用伐鬼方，三年有赏于大国。</p>
                    <p>六五：贞吉，无悔，君子之光，有孚，吉。</p>
                    <p>上九：有孚于饮酒，无咎，濡其首，有孚失是。</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 目录面板 -->
    <div class="directory-panel" id="directory-panel">
        <div class="panel-content">
            <h3 style="color: #ffffff; margin-bottom: 15px;">目录</h3>
        <ul class="toc">
            <li class="toc-item">
                <a href="#" data-section="xici-shang">
                    《系辞传·上》
                    <span class="toc-toggle">▶</span>
                </a>
                <ul class="toc-sub">
                    <li><a href="#" data-chapter="xici-shang-1">系辞传上·第一章</a></li>
                    <li><a href="#" data-chapter="xici-shang-2">系辞传上·第二章</a></li>
                    <li><a href="#" data-chapter="xici-shang-3">系辞传上·第三章</a></li>
                    <li><a href="#" data-chapter="xici-shang-4">系辞传上·第四章</a></li>
                    <li><a href="#" data-chapter="xici-shang-5">系辞传上·第五章</a></li>
                    <li><a href="#" data-chapter="xici-shang-6">系辞传上·第六章</a></li>
                    <li><a href="#" data-chapter="xici-shang-7">系辞传上·第七章</a></li>
                    <li><a href="#" data-chapter="xici-shang-8">系辞传上·第八章</a></li>
                    <li><a href="#" data-chapter="xici-shang-9">系辞传上·第九章</a></li>
                    <li><a href="#" data-chapter="xici-shang-10">系辞传上·第十章</a></li>
                    <li><a href="#" data-chapter="xici-shang-11">系辞传上·第十一章</a></li>
                    <li><a href="#" data-chapter="xici-shang-12">系辞传上·第十二章</a></li>
                </ul>
            </li>
            <li class="toc-item">
                <a href="#" data-section="xici-xia">
                    《系辞传·下》
                    <span class="toc-toggle">▶</span>
                </a>
                <ul class="toc-sub">
                    <li><a href="#" data-chapter="xici-xia-1">系辞传下·第一章</a></li>
                    <li><a href="#" data-chapter="xici-xia-2">系辞传下·第二章</a></li>
                    <li><a href="#" data-chapter="xici-xia-3">系辞传下·第三章</a></li>
                    <li><a href="#" data-chapter="xici-xia-4">系辞传下·第四章</a></li>
                    <li><a href="#" data-chapter="xici-xia-5">系辞传下·第五章</a></li>
                    <li><a href="#" data-chapter="xici-xia-6">系辞传下·第六章</a></li>
                    <li><a href="#" data-chapter="xici-xia-7">系辞传下·第七章</a></li>
                    <li><a href="#" data-chapter="xici-xia-8">系辞传下·第八章</a></li>
                    <li><a href="#" data-chapter="xici-xia-9">系辞传下·第九章</a></li>
                    <li><a href="#" data-chapter="xici-xia-10">系辞传下·第十章</a></li>
                    <li><a href="#" data-chapter="xici-xia-11">系辞传下·第十一章</a></li>
                    <li><a href="#" data-chapter="xici-xia-12">系辞传下·第十二章</a></li>
                </ul>
            </li>
            
            <li class="toc-item">
                <a href="#" data-section="shuogua">
                    《说卦传》
                    <span class="toc-toggle">▶</span>
                </a>
                <ul class="toc-sub">
                    <li><a href="#" data-chapter="shuogua-1">说卦传·第一章</a></li>
                    <li><a href="#" data-chapter="shuogua-2">说卦传·第二章</a></li>
                    <li><a href="#" data-chapter="shuogua-3">说卦传·第三章</a></li>
                    <li><a href="#" data-chapter="shuogua-4">说卦传·第四章</a></li>
                    <li><a href="#" data-chapter="shuogua-5">说卦传·第五章</a></li>
                    <li><a href="#" data-chapter="shuogua-6">说卦传·第六章</a></li>
                    <li><a href="#" data-chapter="shuogua-7">说卦传·第七章</a></li>
                    <li><a href="#" data-chapter="shuogua-8">说卦传·第八章</a></li>
                    <li><a href="#" data-chapter="shuogua-9">说卦传·第九章</a></li>
                    <li><a href="#" data-chapter="shuogua-10">说卦传·第十章</a></li>
                    <li><a href="#" data-chapter="shuogua-11">说卦传·第十一章</a></li>
                </ul>
            </li>
            
            <li class="toc-item">
                <a href="#" data-section="xugua">
                    《序卦传》
                    <span class="toc-toggle">▶</span>
                </a>
                <ul class="toc-sub">
                    <li><a href="#" data-chapter="xugua-shang">序卦传·上篇</a></li>
                    <li><a href="#" data-chapter="xugua-xia">序卦传·下篇</a></li>
                </ul>
            </li>
            
            <li class="toc-item">
                <a href="#" data-section="zagua">《杂卦传》</a>
            </li>
            
            <li class="toc-item">
                <a href="#" data-section="yijing-shang">
                    《易经·上》
                    <span class="toc-toggle">▶</span>
                </a>
                <ul class="toc-sub">
                    <li><a href="#" data-chapter="gua-1">乾为天第一</a></li>
                    <li><a href="#" data-chapter="gua-2">坤为地第二</a></li>
                    <li><a href="#" data-chapter="gua-3">水雷屯第三</a></li>
                    <li><a href="#" data-chapter="gua-4">山水蒙第四</a></li>
                    <li><a href="#" data-chapter="gua-5">水天需第五</a></li>
                    <li><a href="#" data-chapter="gua-6">天水讼第六</a></li>
                    <li><a href="#" data-chapter="gua-7">地水师第七</a></li>
                    <li><a href="#" data-chapter="gua-8">水地比第八</a></li>
                    <li><a href="#" data-chapter="gua-9">风天小畜第九</a></li>
                    <li><a href="#" data-chapter="gua-10">天泽履第十</a></li>
                    <li><a href="#" data-chapter="gua-11">地天泰第十一</a></li>
                    <li><a href="#" data-chapter="gua-12">天地否第十二</a></li>
                    <li><a href="#" data-chapter="gua-13">天火同人第十三</a></li>
                    <li><a href="#" data-chapter="gua-14">火天大有第十四</a></li>
                    <li><a href="#" data-chapter="gua-15">地山谦第十五</a></li>
                    <li><a href="#" data-chapter="gua-16">雷地豫第十六</a></li>
                    <li><a href="#" data-chapter="gua-17">泽雷随第十七</a></li>
                    <li><a href="#" data-chapter="gua-18">山风蛊第十八</a></li>
                    <li><a href="#" data-chapter="gua-19">地泽临第十九</a></li>
                    <li><a href="#" data-chapter="gua-20">风地观第二十</a></li>
                    <li><a href="#" data-chapter="gua-21">火雷噬嗑第二十一</a></li>
                    <li><a href="#" data-chapter="gua-22">山火贲第二十二</a></li>
                    <li><a href="#" data-chapter="gua-23">山地剥第二十三</a></li>
                    <li><a href="#" data-chapter="gua-24">地雷复第二十四</a></li>
                    <li><a href="#" data-chapter="gua-25">天雷无妄第二十五</a></li>
                    <li><a href="#" data-chapter="gua-26">山天大畜第二十六</a></li>
                    <li><a href="#" data-chapter="gua-27">山雷颐第二十七</a></li>
                    <li><a href="#" data-chapter="gua-28">泽风大过第二十八</a></li>
                    <li><a href="#" data-chapter="gua-29">坎为水第二十九</a></li>
                    <li><a href="#" data-chapter="gua-30">离为火第三十</a></li>
                </ul>
            </li>
            
            <li class="toc-item">
                <a href="#" data-section="yijing-xia">
                    《易经·下》
                    <span class="toc-toggle">▶</span>
                </a>
                <ul class="toc-sub">
                    <li><a href="#" data-chapter="gua-31">泽山咸第三十一</a></li>
                    <li><a href="#" data-chapter="gua-32">雷风恒第三十二</a></li>
                    <li><a href="#" data-chapter="gua-33">天山遁第三十三</a></li>
                    <li><a href="#" data-chapter="gua-34">雷天大壮第三十四</a></li>
                    <li><a href="#" data-chapter="gua-35">火地晋第三十五</a></li>
                    <li><a href="#" data-chapter="gua-36">地火明夷第三十六</a></li>
                    <li><a href="#" data-chapter="gua-37">风火家人第三十七</a></li>
                    <li><a href="#" data-chapter="gua-38">火泽睽第三十八</a></li>
                    <li><a href="#" data-chapter="gua-39">水山蹇第三十九</a></li>
                    <li><a href="#" data-chapter="gua-40">雷水解第四十</a></li>
                    <li><a href="#" data-chapter="gua-41">山泽损第四十一</a></li>
                    <li><a href="#" data-chapter="gua-42">风雷益第四十二</a></li>
                    <li><a href="#" data-chapter="gua-43">泽天夬第四十三</a></li>
                    <li><a href="#" data-chapter="gua-44">天风姤第四十四</a></li>
                    <li><a href="#" data-chapter="gua-45">泽地萃第四十五</a></li>
                    <li><a href="#" data-chapter="gua-46">地风升第四十六</a></li>
                    <li><a href="#" data-chapter="gua-47">泽水困第四十七</a></li>
                    <li><a href="#" data-chapter="gua-48">水风井第四十八</a></li>
                    <li><a href="#" data-chapter="gua-49">泽火革第四十九</a></li>
                    <li><a href="#" data-chapter="gua-50">火风鼎第五十</a></li>
                    <li><a href="#" data-chapter="gua-51">震为雷第五十一</a></li>
                    <li><a href="#" data-chapter="gua-52">艮为山第五十二</a></li>
                    <li><a href="#" data-chapter="gua-53">风山渐第五十三</a></li>
                    <li><a href="#" data-chapter="gua-54">雷泽归妹第五十四</a></li>
                    <li><a href="#" data-chapter="gua-55">雷火丰第五十五</a></li>
                    <li><a href="#" data-chapter="gua-56">火山旅第五十六</a></li>
                    <li><a href="#" data-chapter="gua-57">巽为风第五十七</a></li>
                    <li><a href="#" data-chapter="gua-58">兑为泽第五十八</a></li>
                    <li><a href="#" data-chapter="gua-59">风水涣第五十九</a></li>
                    <li><a href="#" data-chapter="gua-60">水泽节第六十</a></li>
                    <li><a href="#" data-chapter="gua-61">风泽中孚第六十一</a></li>
                    <li><a href="#" data-chapter="gua-62">雷山小过第六十二</a></li>
                    <li><a href="#" data-chapter="gua-63">水火既济第六十三</a></li>
                    <li><a href="#" data-chapter="gua-64">火水未济第六十四</a></li>
                </ul>
            </li>
        </ul>
    </div>
            </div>

    <!-- 笔记面板 -->
    <div class="panel" id="notes-panel">
        <div class="panel-content">
            <h3 style="color: #ffffff; margin-bottom: 15px;">所有笔记</h3>
            <div id="all-notes-list">
                <p style="color: #999; text-align: center; padding: 20px;">暂无笔记</p>
            </div>
            </div>
            </div>

    <!-- 设置面板 -->
    <div class="panel" id="settings-panel">
        <div class="panel-content">
            <h3 style="color: #ffffff; margin-bottom: 15px;">设置</h3>
            <div class="setting-item">
                <label style="color: #e0e0e0; margin-bottom: 5px; display: block;">字体大小：</label>
                <input type="range" id="font-size-slider" min="12" max="24" value="16" style="width: 100%;">
                <span id="font-size-value" style="color: #999; font-size: 12px;">16px</span>
            </div>
            <div class="setting-item" style="margin-top: 15px;">
                <label style="color: #e0e0e0; margin-bottom: 5px; display: block;">行间距：</label>
                <input type="range" id="line-spacing-slider" min="1.2" max="2.5" step="0.1" value="1.6" style="width: 100%;">
                <span id="line-spacing-value" style="color: #999; font-size: 12px;">1.6</span>
            </div>
            <div class="setting-item" style="margin-top: 15px;">
                <label style="color: #e0e0e0; margin-bottom: 5px; display: block;">字体颜色：</label>
                <input type="color" id="font-color-picker" value="#2c2c2c" style="width: 50px; height: 30px;">
            </div>
            <div class="setting-item" style="margin-top: 15px;">
                <label style="color: #e0e0e0; margin-bottom: 5px; display: block;">背景颜色：</label>
                <input type="color" id="bg-color-picker" value="#f5f5dc" style="width: 50px; height: 30px;">
            </div>
            </div>
            </div>

    <!-- 笔记弹窗 -->
    <div class="note-overlay" id="note-overlay"></div>
    <div class="note-popup" id="note-popup">
        <h3>添加笔记</h3>
        <textarea id="note-text" placeholder="请输入笔记内容..."></textarea>
        <div class="button-group">
            <button class="save-btn" id="save-note-btn">保存笔记</button>
            <button class="delete-btn" id="delete-note-btn">删除笔记</button>
            <button class="cancel-btn" id="cancel-note-btn">取消</button>
            </div>
        </div>

    <!-- 底部导航栏 -->
    <div class="bottom-nav">
        <div class="nav-item" id="nav-directory">
            <div class="nav-icon">📁</div>
            <div class="nav-label">目录</div>
                </div>
        <div class="nav-item" id="nav-night-mode">
            <div class="nav-icon">🌙</div>
            <div class="nav-label">夜间</div>
                </div>
        <div class="nav-item" id="nav-notes">
            <div class="nav-icon">📝</div>
            <div class="nav-label">笔记</div>
            </div>
        <div class="nav-item" id="nav-settings">
            <div class="nav-icon">⚙️</div>
            <div class="nav-label">设置</div>
        </div>
    </div>

    <script>
        // 全局变量
        let currentPanel = null;
        let isNightMode = false;
        let selectedText = '';
        let selectedRange = null;
        let noteBtnContainer = null;

        // 上传本地笔记到云端
        function uploadLocalNoteToCloud(noteId, noteData) {
            try {
                if (window.parent) {
                    const cloudNoteData = {
                        chapterId: 'zhouyi',
                        chapterTitle: '《周易》',
                        content: noteData.note,
                        highlights: [{
                            text: noteData.text,
                            noteId: noteId
                        }]
                    };
                    
                    const targetOrigin = window.location.protocol === 'file:' ? '*' : (window.location.origin || '*');
                    window.parent.postMessage({
                        type: 'saveBookNote',
                        data: cloudNoteData
                    }, targetOrigin);
                    
                    // 监听上传结果
                    const handleUploadResponse = (event) => {
                        if (event.data.type === 'saveBookNoteResponse') {
                            window.removeEventListener('message', handleUploadResponse);
                            if (event.data.success) {
                                console.log('本地笔记上传成功:', noteId);
                                // 标记为已上传并保存云端ID
                                noteData.uploaded = true;
                                if (event.data.data && event.data.data.id) {
                                    noteData.cloudId = event.data.data.id;
                                    console.log('保存云端ID:', event.data.data.id);
                                }
                                localStorage.setItem(noteId, JSON.stringify(noteData));
                            } else {
                                console.log('本地笔记上传失败:', event.data.error);
                            }
                        }
                    };
                    window.addEventListener('message', handleUploadResponse);
                    
                    // 设置超时
                    setTimeout(() => {
                        window.removeEventListener('message', handleUploadResponse);
                    }, 5000);
                }
            } catch (error) {
                console.log('上传本地笔记出错:', error);
            }
        }

        // 底部导航栏功能 - 等待DOM加载完成
        function initBottomNav() {
            const navDirectory = document.getElementById('nav-directory');
            const navNightMode = document.getElementById('nav-night-mode');
            const navNotes = document.getElementById('nav-notes');
            const navSettings = document.getElementById('nav-settings');
            
            if (navDirectory) {
                navDirectory.addEventListener('click', function() {
                    togglePanel('directory-panel');
                });
            }
            
            if (navNightMode) {
                navNightMode.addEventListener('click', function() {
                    toggleNightMode();
                });
            }
            
            if (navNotes) {
                navNotes.addEventListener('click', function() {
                    togglePanel('notes-panel');
                });
            }
            
            if (navSettings) {
                navSettings.addEventListener('click', function() {
                    togglePanel('settings-panel');
                });
            }
        }

        // 切换面板显示/隐藏
        function togglePanel(panelId) {
            const panel = document.getElementById(panelId);
            if (currentPanel === panel) {
                panel.classList.remove('show');
                currentPanel = null;
            } else {
                if (currentPanel) {
                    currentPanel.classList.remove('show');
                }
                panel.classList.add('show');
                currentPanel = panel;
            }
        }

        // 切换夜间模式
        function toggleNightMode() {
            isNightMode = !isNightMode;
            document.body.classList.toggle('night-mode', isNightMode);
            localStorage.setItem('nightMode', isNightMode);
            
            // 更新夜间模式按钮状态
            const nightModeBtn = document.getElementById('nav-night-mode');
            if (isNightMode) {
                nightModeBtn.querySelector('.nav-icon').textContent = '☀️';
                nightModeBtn.querySelector('.nav-label').textContent = '日间';
            } else {
                nightModeBtn.querySelector('.nav-icon').textContent = '🌙';
                nightModeBtn.querySelector('.nav-label').textContent = '夜间';
            }
        }

        // 目录折叠/展开功能
        document.querySelectorAll('.toc-toggle').forEach(toggle => {
            toggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const tocItem = this.parentElement.parentElement;
                
                // 关闭其他打开的一级目录
                document.querySelectorAll('.toc-item').forEach(item => {
                    if (item !== tocItem) {
                        item.classList.remove('active');
                    }
                });
                
                tocItem.classList.toggle('active');
            });
        });

        // 目录点击跳转功能
        document.querySelectorAll('.toc a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('data-chapter') || this.getAttribute('data-section');
                if (targetId) {
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        // 自动关闭目录面板
                        const directoryPanel = document.getElementById('directory-panel');
                        directoryPanel.classList.remove('show');
                        currentPanel = null;
                    }
                }
            });
        });

        // 笔记功能
        function initTextSelectionNotes() {
            // 处理文字选择
            function handleTextSelection(e) {
                setTimeout(() => {
                    const selection = window.getSelection();
                    const text = selection.toString().trim();
                    
                    if (text.length > 0) {
                        selectedText = text;
                        selectedRange = selection.getRangeAt(0);
                        showNoteButton(e);
                    } else {
                        hideNoteButton();
                    }
                }, 100);
            }
            
            // 处理点击外部
            function handleClickOutside(e) {
                if (noteBtnContainer && !noteBtnContainer.contains(e.target)) {
                    hideNoteButton();
                }
            }
            
            // 鼠标事件（桌面端）
            document.addEventListener('mouseup', handleTextSelection);
            document.addEventListener('mousedown', handleClickOutside);
            
            // 触摸事件（移动端）
            document.addEventListener('touchend', handleTextSelection);
            document.addEventListener('touchstart', handleClickOutside);
            
            // 添加移动端文字选择样式
            const style = document.createElement('style');
            style.textContent = `
                .main-content {
                    -webkit-user-select: text;
                    -moz-user-select: text;
                    -ms-user-select: text;
                    user-select: text;
                    -webkit-touch-callout: default;
                }
                
                .main-content * {
                    -webkit-user-select: text;
                    -moz-user-select: text;
                    -ms-user-select: text;
                    user-select: text;
                    -webkit-touch-callout: default;
                }
            `;
            document.head.appendChild(style);

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    hideNoteButton();
                }
            });

            // 点击高亮文字显示笔记
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('highlighted-text')) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const noteId = e.target.getAttribute('data-note-id');
                    const text = e.target.textContent;
                    
                    // 设置选中的文字和范围
                    selectedText = text;
                    const range = document.createRange();
                    range.selectNode(e.target);
                    selectedRange = range;
                    
                    // 显示笔记弹窗
                    showNotePopup();
                }
            });
        }

        function showNoteButton(e) {
            hideNoteButton();
            
            noteBtnContainer = document.createElement('div');
            noteBtnContainer.className = 'note-button-container';
            
            const noteBtn = document.createElement('button');
            noteBtn.className = 'note-option-btn';
            noteBtn.textContent = '📝 写笔记';
            noteBtn.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                showNotePopup();
                hideNoteButton();
            };
            
            noteBtnContainer.appendChild(noteBtn);
            document.body.appendChild(noteBtnContainer);
            
            const rect = selectedRange.getBoundingClientRect();
            noteBtnContainer.style.left = (rect.left + window.scrollX) + 'px';
            noteBtnContainer.style.top = (rect.bottom + window.scrollY + 5) + 'px';
        }

        function hideNoteButton() {
            if (noteBtnContainer) {
                noteBtnContainer.remove();
                noteBtnContainer = null;
            }
        }

        function showNotePopup(triggerElement = null) {
            const overlay = document.getElementById('note-overlay');
            const popup = document.getElementById('note-popup');
            const textarea = document.getElementById('note-text');
            
            // 检查是否已有笔记
            const noteId = generateNoteId(selectedText);
            const existingNote = localStorage.getItem(noteId);
            
            if (existingNote) {
                try {
                    const noteData = JSON.parse(existingNote);
                    textarea.value = noteData.note || '';
                } catch (e) {
                    textarea.value = existingNote;
                }
            } else {
                textarea.value = '';
            }
            
            overlay.style.display = 'block';
            popup.style.display = 'block';
            
            // 如果有触发元素，将弹窗定位到该元素上方
            if (triggerElement) {
                const rect = triggerElement.getBoundingClientRect();
                const popupRect = popup.getBoundingClientRect();
                
                // 计算弹窗位置（在触发元素上方）
                let top = rect.top - popupRect.height - 10;
                let left = rect.left + (rect.width - popupRect.width) / 2;
                
                // 确保弹窗不超出屏幕边界
                if (top < 10) {
                    top = rect.bottom + 10; // 如果上方空间不够，显示在下方
                }
                if (left < 10) {
                    left = 10;
                }
                if (left + popupRect.width > window.innerWidth - 10) {
                    left = window.innerWidth - popupRect.width - 10;
                }
                
                popup.style.position = 'fixed';
                popup.style.top = top + 'px';
                popup.style.left = left + 'px';
                popup.style.transform = 'none';
            } else {
                // 默认居中显示
                popup.style.position = 'fixed';
                popup.style.top = '50%';
                popup.style.left = '50%';
                popup.style.transform = 'translate(-50%, -50%)';
            }
            
            textarea.focus();
        }

        function hideNotePopup() {
            const overlay = document.getElementById('note-overlay');
            const popup = document.getElementById('note-popup');
            overlay.style.display = 'none';
            popup.style.display = 'none';
        }

        function generateNoteId(text) {
            return 'text_note_' + text.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '');
        }
        
        // 查找相同文字的现有笔记ID
        function findExistingNoteId(text) {
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('text_note_')) {
                    try {
                        const noteData = JSON.parse(localStorage.getItem(key));
                        if (noteData.text === text) {
                            return key;
                        }
                    } catch (e) {
                        // 处理旧格式
                        if (key.replace('text_note_', '') === text) {
                            return key;
                        }
                    }
                }
            }
            return null;
        }

        async function saveNote() {
            const textarea = document.getElementById('note-text');
            const noteContent = textarea.value.trim();
            const popup = document.getElementById('note-popup');
            const editingNoteId = popup.getAttribute('data-editing-note-id');
            
            if (noteContent) {
                let noteId;
                
                if (editingNoteId) {
                    // 编辑模式：使用现有ID
                    noteId = editingNoteId;
                } else {
                    // 新建模式：检查是否已存在相同文字的笔记
                    const existingId = findExistingNoteId(selectedText);
                    if (existingId) {
                        // 如果存在相同文字的笔记，更新它
                        noteId = existingId;
                        console.log('找到相同文字的现有笔记，将更新:', noteId);
                    } else {
                        // 如果不存在，生成新ID
                        noteId = generateNoteId(selectedText);
                        console.log('创建新笔记:', noteId);
                    }
                }
                
                const noteData = {
                    text: selectedText,
                    note: noteContent,
                    timestamp: new Date().toISOString(),
                    uploaded: false // 标记为未上传
                };
                
                // 保存到本地存储
                localStorage.setItem(noteId, JSON.stringify(noteData));
                
                // 尝试保存到云端
                try {
                    if (window.parent) {
                        // 使用postMessage与父窗口通信
                        const targetOrigin = window.location.protocol === 'file:' ? '*' : (window.location.origin || '*');
                        window.parent.postMessage({
                            type: 'saveBookNote',
                            data: {
                                chapterId: 'zhouyi',
                                chapterTitle: '《周易》',
                                content: noteContent,
                                highlights: [{
                                    text: selectedText,
                                    noteId: noteId
                                }]
                            }
                        }, targetOrigin);
                        console.log('已请求保存笔记到云端');
                        
                        // 监听云端保存结果
                        const handleSaveResponse = (event) => {
                            if (event.data.type === 'saveBookNoteResponse') {
                                window.removeEventListener('message', handleSaveResponse);
                                if (event.data.success) {
                                    console.log('云端保存成功，标记为已上传');
                                    // 标记为已上传并保存云端ID
                                    noteData.uploaded = true;
                                    if (event.data.data && event.data.data.id) {
                                        noteData.cloudId = event.data.data.id;
                                        console.log('保存云端ID:', event.data.data.id);
                                    }
                                    localStorage.setItem(noteId, JSON.stringify(noteData));
                                    loadAllNotes();
                                } else {
                                    console.log('云端保存失败，仅使用本地笔记');
                                    loadAllNotes();
                                }
                            }
                        };
                        window.addEventListener('message', handleSaveResponse);
                        
                        // 设置超时，避免无限等待
                        setTimeout(() => {
                            window.removeEventListener('message', handleSaveResponse);
                            console.log('云端保存超时，使用本地笔记');
                            loadAllNotes();
                        }, 5000);
                    } else {
                        // 没有父窗口，直接重新加载本地笔记
                        loadAllNotes();
                    }
                } catch (error) {
                    console.log('云端保存失败，仅保存到本地:', error);
                    loadAllNotes();
                }
                
                if (!editingNoteId) {
                    // 只有新建时才添加高亮
                highlightSelectedText(noteId);
                }
                
                loadAllNotes();
            }
            
            // 清除编辑状态
            popup.removeAttribute('data-editing-note-id');
            hideNotePopup();
        }

        async function deleteNote() {
            const noteId = generateNoteId(selectedText);
            
            // 获取笔记数据，检查是否有云端ID
            const noteDataStr = localStorage.getItem(noteId);
            let cloudId = null;
            
            if (noteDataStr) {
                try {
                    const noteData = JSON.parse(noteDataStr);
                    cloudId = noteData.cloudId;
                } catch (e) {
                    console.log('解析笔记数据失败:', e);
                }
            }
            
            // 从本地存储删除
            localStorage.removeItem(noteId);
            
            // 尝试从云端删除
            try {
                if (window.parent) {
                    const targetOrigin = window.location.protocol === 'file:' ? '*' : (window.location.origin || '*');
                    
                    // 监听云端删除响应
                    const handleDeleteResponse = (event) => {
                        if (event.data.type === 'deleteBookNoteResponse') {
                            window.removeEventListener('message', handleDeleteResponse);
                            console.log('云端删除响应:', event.data);
                            // 无论云端删除成功与否，都重新加载笔记列表
                            loadAllNotes();
                        }
                    };
                    window.addEventListener('message', handleDeleteResponse);
                    
                    if (cloudId) {
                        // 使用云端ID删除
                        window.parent.postMessage({
                            type: 'deleteBookNote',
                            data: {
                                noteId: cloudId
                            }
                        }, targetOrigin);
                        console.log('已请求从云端删除笔记（使用云端ID）:', cloudId);
                    } else {
                        // 使用本地ID删除（云端会通过文字内容查找）
                        window.parent.postMessage({
                            type: 'deleteBookNote',
                            data: {
                                noteId: noteId
                            }
                        }, targetOrigin);
                        console.log('已请求从云端删除笔记（使用本地ID）:', noteId);
                    }
                    
                    // 设置超时，避免无限等待
                    setTimeout(() => {
                        window.removeEventListener('message', handleDeleteResponse);
                        console.log('云端删除超时，重新加载笔记列表');
                        loadAllNotes();
                    }, 5000);
                } else {
                    // 没有父窗口，直接重新加载
                    loadAllNotes();
                }
            } catch (error) {
                console.log('云端删除失败，仅从本地删除:', error);
                loadAllNotes();
            }
            
            removeHighlight(noteId);
            hideNotePopup();
        }

        function highlightSelectedText(noteId) {
            if (selectedRange) {
                const span = document.createElement('span');
                span.className = 'highlighted-text';
                span.setAttribute('data-note-id', noteId);
                span.textContent = selectedText;
                
                try {
                    selectedRange.deleteContents();
                    selectedRange.insertNode(span);
                } catch (e) {
                    console.error('Error highlighting text:', e);
                }
            }
        }

        function removeHighlight(noteId) {
            const highlights = document.querySelectorAll(`[data-note-id="${noteId}"]`);
            highlights.forEach(highlight => {
                const parent = highlight.parentNode;
                parent.replaceChild(document.createTextNode(highlight.textContent), highlight);
                parent.normalize();
            });
        }

        async function loadAllNotes() {
            const notesList = document.getElementById('all-notes-list');
            let notes = [];
            
            // 首先尝试从云端加载笔记
            try {
                if (window.parent) {
                    console.log('开始从云端加载笔记...');
                    console.log('发送getBookNotes请求到父窗口');
                    // 使用postMessage请求云端笔记
                    const targetOrigin = window.location.protocol === 'file:' ? '*' : (window.location.origin || '*');
                    window.parent.postMessage({
                        type: 'getBookNotes',
                        data: {
                            chapterId: 'zhouyi'
                        }
                    }, targetOrigin);
                    
                    // 等待云端笔记响应
                    await new Promise((resolve) => {
                        const handleMessage = (event) => {
                            console.log('收到云端笔记响应:', event.data);
                            if (event.data.type === 'bookNotesResponse') {
                                window.removeEventListener('message', handleMessage);
                                console.log('云端笔记响应详情:', {
                                    success: event.data.success,
                                    dataLength: event.data.data?.length || 0,
                                    error: event.data.error
                                });
                                if (event.data.success) {
                                    console.log('云端笔记加载成功，数量:', event.data.data?.length || 0);
                                    // 将云端笔记转换为本地格式
                                    const cloudNotes = event.data.data || [];
                                    cloudNotes.forEach(cloudNote => {
                                        const highlightText = cloudNote.highlights?.[0]?.text || '';
                                        if (highlightText) {
                                            // 使用文字内容作为ID，确保相同文字的笔记使用同一个ID
                                            const localNoteId = `text_note_${highlightText.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '')}`;
                                            const localNoteData = {
                                                text: highlightText,
                                                note: cloudNote.content,
                                                timestamp: cloudNote.createdAt || new Date().toISOString(),
                                                uploaded: true, // 标记为已上传，避免重复上传
                                                cloudId: cloudNote.id // 保存云端ID，用于后续更新
                                            };
                                            localStorage.setItem(localNoteId, JSON.stringify(localNoteData));
                                            console.log('云端笔记已缓存到本地:', localNoteId);
                                        }
                                    });
                                } else {
                                    console.log('云端笔记加载失败:', event.data.error);
                                }
                                resolve();
                            }
                        };
                        window.addEventListener('message', handleMessage);
                        console.log('已添加云端笔记响应监听器');
                        
                        // 设置超时，避免无限等待
                        setTimeout(() => {
                            window.removeEventListener('message', handleMessage);
                            console.log('云端笔记加载超时，使用本地笔记');
                            resolve();
                        }, 10000); // 增加超时时间到10秒
                    });
                } else {
                    console.log('没有父窗口，跳过云端笔记加载');
                }
            } catch (error) {
                console.log('云端笔记加载失败，使用本地笔记:', error);
            }
            
            // 从本地存储加载笔记
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('text_note_')) {
                    try {
                        const noteData = JSON.parse(localStorage.getItem(key));
                        notes.push({
                            id: key,
                            text: noteData.text,
                            note: noteData.note,
                            timestamp: noteData.timestamp
                        });
                        
                        // 检查是否需要上传到云端
                        if (window.parent && !noteData.uploaded) {
                            console.log('发现未上传的本地笔记，尝试上传到云端:', key);
                            uploadLocalNoteToCloud(key, noteData);
                        }
                    } catch (e) {
                        // 处理旧格式
                        notes.push({
                            id: key,
                            text: key.replace('text_note_', ''),
                            note: localStorage.getItem(key),
                            timestamp: new Date().toISOString()
                        });
                    }
                }
            }
            
            if (notes.length === 0) {
                notesList.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">暂无笔记</p>';
            } else {
                notesList.innerHTML = notes.map(note => `
                    <div class="note-item" style="position: relative;" data-note-id="${note.id}">
                        <div class="note-text-highlight" style="color: #ffeb3b; font-weight: bold; margin-bottom: 5px; cursor: pointer;" data-note-id="${note.id}">${note.text}</div>
                        <div style="color: #e0e0e0; margin-bottom: 5px;">${note.note}</div>
                        <div style="color: #999; font-size: 12px; margin-bottom: 10px;">${new Date(note.timestamp).toLocaleString()}</div>
                        <div style="display: flex; gap: 10px;">
                            <button class="edit-note-btn" style="background-color: #007AFF; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;" data-note-id="${note.id}">修改</button>
                            <button class="delete-note-btn" style="background-color: #ff4444; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;" data-note-id="${note.id}">删除</button>
                        </div>
                    </div>
                `).join('');
                
                // 添加点击跳转事件监听
                addNoteJumpListeners();
                
                // 添加删除功能事件监听（右击和左滑）
                addDeleteNoteListeners();
            }
        }
        
        // 添加删除笔记事件监听器
        function addDeleteNoteListeners() {
            // 修改按钮事件
            const editButtons = document.querySelectorAll('.edit-note-btn');
            editButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const noteId = this.getAttribute('data-note-id');
                    const noteItem = this.closest('.note-item');
                    editNote(noteId, noteItem);
                });
            });
            
            // 删除按钮事件
            const deleteButtons = document.querySelectorAll('.delete-note-btn');
            deleteButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const noteId = this.getAttribute('data-note-id');
                    console.log('删除按钮被点击，笔记ID:', noteId);
                    
                    // 检查是否已经是确认状态
                    if (this.textContent === '删除') {
                        // 第一次点击，改为确认删除
                        this.textContent = '确认删除';
                        this.style.backgroundColor = '#ff0000';
                        
                        // 3秒后自动恢复
                        setTimeout(() => {
                            this.textContent = '删除';
                            this.style.backgroundColor = '#ff4444';
                        }, 3000);
                    } else {
                        // 第二次点击，执行删除
                        console.log('执行删除操作');
                        
                        // 调用统一的删除函数，确保云端同步
                        deleteNoteById(noteId);
                    }
                });
            });
        }
        
        // 通过ID删除笔记
        async function deleteNoteById(noteId) {
            console.log('deleteNoteById 被调用，笔记ID:', noteId);
            
            // 检查笔记是否存在
            const noteDataStr = localStorage.getItem(noteId);
            if (!noteDataStr) {
                console.log('笔记不存在，无法删除:', noteId);
                return;
            }
            
            // 获取笔记数据，检查是否有云端ID
            let cloudId = null;
            
            if (noteDataStr) {
                try {
                    const noteData = JSON.parse(noteDataStr);
                    cloudId = noteData.cloudId;
                    console.log('笔记数据:', { text: noteData.text, cloudId: cloudId, uploaded: noteData.uploaded });
                } catch (e) {
                    console.log('解析笔记数据失败:', e);
                }
            }
            
            // 从localStorage中删除
            localStorage.removeItem(noteId);
            
            // 移除页面上的高亮
            removeHighlight(noteId);
            
            // 尝试从云端删除
            if (cloudId && window.parent) {
                try {
                    const targetOrigin = window.location.protocol === 'file:' ? '*' : (window.location.origin || '*');
                    
                    // 监听云端删除响应
                    const handleDeleteResponse = (event) => {
                        if (event.data.type === 'deleteBookNoteResponse') {
                            window.removeEventListener('message', handleDeleteResponse);
                            console.log('云端删除响应:', event.data);
                            loadAllNotes();
                        }
                    };
                    window.addEventListener('message', handleDeleteResponse);
                    
                    window.parent.postMessage({
                        type: 'deleteBookNote',
                        data: {
                            noteId: cloudId // 使用云端ID
                        }
                    }, targetOrigin);
                    console.log('已请求从云端删除笔记:', cloudId);
                    
                    // 设置超时
                    setTimeout(() => {
                        window.removeEventListener('message', handleDeleteResponse);
                        loadAllNotes();
                    }, 5000);
                } catch (error) {
                    console.log('云端删除失败，仅从本地删除:', error);
                    loadAllNotes();
                }
            } else if (window.parent) {
                // 如果没有云端ID，尝试通过文字内容查找云端记录
                try {
                    const targetOrigin = window.location.protocol === 'file:' ? '*' : (window.location.origin || '*');
                    
                    // 监听云端删除响应
                    const handleDeleteResponse = (event) => {
                        if (event.data.type === 'deleteBookNoteResponse') {
                            window.removeEventListener('message', handleDeleteResponse);
                            console.log('云端删除响应:', event.data);
                            loadAllNotes();
                        }
                    };
                    window.addEventListener('message', handleDeleteResponse);
                    
                    window.parent.postMessage({
                        type: 'deleteBookNote',
                        data: {
                            noteId: noteId // 使用本地ID
                        }
                    }, targetOrigin);
                    console.log('已请求从云端删除笔记:', noteId);
                    
                    // 设置超时
                    setTimeout(() => {
                        window.removeEventListener('message', handleDeleteResponse);
                        loadAllNotes();
                    }, 5000);
                } catch (error) {
                    console.log('云端删除失败，仅从本地删除:', error);
                    loadAllNotes();
                }
            } else {
                // 没有父窗口，直接重新加载
                loadAllNotes();
            }
            
            console.log('笔记已删除:', noteId);
        }
        
        // 编辑笔记
        function editNote(noteId, triggerElement = null) {
            // 获取现有笔记数据
            const noteData = localStorage.getItem(noteId);
            if (!noteData) {
                console.log('笔记不存在:', noteId);
                return;
            }
            
            let noteText = '';
            let noteContent = '';
            
            try {
                const parsed = JSON.parse(noteData);
                noteText = parsed.text;
                noteContent = parsed.note;
            } catch (e) {
                // 兼容旧格式
                noteText = noteId.replace('text_note_', '');
                noteContent = noteData;
            }
            
            // 设置选中的文本和范围
            selectedText = noteText;
            selectedRange = null;
            
            // 设置当前编辑的笔记ID
            const popup = document.getElementById('note-popup');
            popup.setAttribute('data-editing-note-id', noteId);
            
            // 显示笔记弹窗并填入现有内容
            const textarea = document.getElementById('note-text');
            textarea.value = noteContent;
            
            // 显示弹窗，传递触发元素
            showNotePopup(triggerElement);
            
            // 隐藏笔记面板
            const notesPanel = document.getElementById('notes-panel');
            if (notesPanel) {
                notesPanel.classList.remove('show');
                currentPanel = null;
            }
        }
        
        // 添加笔记跳转事件监听器
        function addNoteJumpListeners() {
            const noteTexts = document.querySelectorAll('.note-text-highlight');
            noteTexts.forEach(textElement => {
                textElement.addEventListener('click', function(e) {
                    // 检查点击的是否是操作按钮
                    if (e.target.closest('.action-buttons') || e.target.closest('.delete-button') || e.target.closest('.edit-button')) {
                        return;
                    }
                    
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const noteId = this.getAttribute('data-note-id');
                    jumpToNoteText(noteId);
                });
            });
        }
        
        // 跳转到笔记原文
        function jumpToNoteText(noteId) {
            // 查找对应的高亮元素（只在主内容区域查找，排除笔记面板）
            const mainContent = document.querySelector('.main-content');
            const highlightElement = mainContent.querySelector(`.highlighted-text[data-note-id="${noteId}"]`);
            
            if (highlightElement) {
                // 隐藏笔记面板
                const notesPanel = document.getElementById('notes-panel');
                if (notesPanel) {
                    notesPanel.classList.remove('show');
                    currentPanel = null;
                }
                
                // 滚动到该元素
                highlightElement.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
                
                // 高亮显示该元素
                highlightElement.style.backgroundColor = '#ffeb3b';
                highlightElement.style.color = '#000';
                highlightElement.style.padding = '2px 4px';
                highlightElement.style.borderRadius = '3px';
                
                // 2秒后恢复原样式
                setTimeout(() => {
                    highlightElement.style.backgroundColor = '';
                    highlightElement.style.color = '';
                    highlightElement.style.padding = '';
                    highlightElement.style.borderRadius = '';
                }, 2000);
            } else {
                console.log('未找到对应的原文高亮');
            }
        }




        // 设置功能
        function initSettings() {
            const fontSizeSlider = document.getElementById('font-size-slider');
            const fontSizeValue = document.getElementById('font-size-value');
            const lineSpacingSlider = document.getElementById('line-spacing-slider');
            const lineSpacingValue = document.getElementById('line-spacing-value');
            const fontColorPicker = document.getElementById('font-color-picker');
            const bgColorPicker = document.getElementById('bg-color-picker');

            fontSizeSlider.addEventListener('input', function() {
                const size = this.value + 'px';
                fontSizeValue.textContent = size;
                document.body.style.fontSize = size;
                localStorage.setItem('fontSize', size);
            });

            lineSpacingSlider.addEventListener('input', function() {
                const spacing = this.value;
                lineSpacingValue.textContent = spacing;
                document.body.style.lineHeight = spacing;
                localStorage.setItem('lineSpacing', spacing);
            });

            fontColorPicker.addEventListener('change', function() {
                document.body.style.color = this.value;
                localStorage.setItem('fontColor', this.value);
            });

            bgColorPicker.addEventListener('change', function() {
                const bgColor = this.value;
                document.body.style.backgroundColor = bgColor;
                document.querySelector('.main-content').style.backgroundColor = bgColor;
                localStorage.setItem('bgColor', bgColor);
            });

            // 加载保存的设置
            const savedFontSize = localStorage.getItem('fontSize');
            const savedLineSpacing = localStorage.getItem('lineSpacing');
            const savedFontColor = localStorage.getItem('fontColor');
            const savedBgColor = localStorage.getItem('bgColor');

            if (savedFontSize) {
                fontSizeSlider.value = parseInt(savedFontSize);
                fontSizeValue.textContent = savedFontSize;
                document.body.style.fontSize = savedFontSize;
            }

            if (savedLineSpacing) {
                lineSpacingSlider.value = savedLineSpacing;
                lineSpacingValue.textContent = savedLineSpacing;
                document.body.style.lineHeight = savedLineSpacing;
            }

            if (savedFontColor) {
                fontColorPicker.value = savedFontColor;
                document.body.style.color = savedFontColor;
            }

            if (savedBgColor) {
                bgColorPicker.value = savedBgColor;
                document.body.style.backgroundColor = savedBgColor;
                document.querySelector('.main-content').style.backgroundColor = savedBgColor;
            }
        }

        // 事件监听器
        document.getElementById('save-note-btn').addEventListener('click', saveNote);
        document.getElementById('delete-note-btn').addEventListener('click', deleteNote);
        document.getElementById('cancel-note-btn').addEventListener('click', hideNotePopup);
        document.getElementById('note-overlay').addEventListener('click', hideNotePopup);

        // 恢复高亮功能
        function restoreHighlights() {
            console.log('开始恢复高亮...');
            
            // 获取所有笔记
            const notes = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('text_note_')) {
                    try {
                        const noteData = JSON.parse(localStorage.getItem(key));
                        notes.push({
                            id: key,
                            text: noteData.text,
                            note: noteData.note
                        });
                    } catch (e) {
                        // 处理旧格式
                        notes.push({
                            id: key,
                            text: key.replace('text_note_', ''),
                            note: localStorage.getItem(key)
                        });
                    }
                }
            }
            
            console.log(`总共找到 ${notes.length} 个笔记`);
            
            // 为每个笔记恢复高亮
            notes.forEach(noteData => {
                const { id: noteId, text } = noteData;
                console.log(`处理笔记: ${text}`);
                
                // 使用TreeWalker搜索文本节点
                const walker = document.createTreeWalker(
                    document.body,
                    NodeFilter.SHOW_TEXT,
                    null,
                    false
                );
                
                let node;
                let found = false;
                let nodeCount = 0;
                
                while (node = walker.nextNode()) {
                    nodeCount++;
                    if (node.textContent.includes(text)) {
                        console.log(`找到匹配文字: ${text} 在节点: ${node.textContent.substring(0, 50)}...`);
                        
                        // 检查是否已经有高亮
                        if (node.parentNode && !node.parentNode.querySelector(`[data-note-id="${noteId}"]`)) {
                            try {
                                const range = document.createRange();
                                const startIndex = node.textContent.indexOf(text);
                                const endIndex = startIndex + text.length;
                                
                                range.setStart(node, startIndex);
                                range.setEnd(node, endIndex);
                                
                                const span = document.createElement('span');
                                span.className = 'highlighted-text';
                                span.setAttribute('data-note-id', noteId);
                                span.textContent = text;
                                
                                range.deleteContents();
                                range.insertNode(span);
                                
                                console.log(`高亮文字已创建: ${text}`);
                                found = true;
                                break;
                            } catch (e) {
                                console.error('高亮创建失败:', e);
                            }
                        }
                    }
                }
                
                if (!found) {
                    console.log(`未找到匹配的文字: ${text} 搜索了 ${nodeCount} 个文本节点`);
                }
            });
            
            console.log('高亮恢复完成');
        }

        // 监听来自父窗口的消息
        window.addEventListener('message', function(event) {
            console.log('电子书iframe收到消息:', event.data);
            if (event.data.type === 'syncNotesAfterLogin') {
                console.log('收到登录后同步笔记的请求，开始重新加载笔记');
                loadAllNotes(); // 重新加载笔记，会从云端获取并缓存到本地
            }
        });

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            const nightMode = localStorage.getItem('nightMode') === 'true';
            if (nightMode) {
                toggleNightMode();
            }
            
            // 初始化底部导航栏
            initBottomNav();
            
            initTextSelectionNotes();
            initSettings();
            loadAllNotes();
            
            // 延迟恢复高亮，确保DOM完全加载
            setTimeout(() => {
                restoreHighlights();
            }, 500);
        });
    </script>
</body>
</html>
